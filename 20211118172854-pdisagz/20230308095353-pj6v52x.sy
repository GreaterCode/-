{
	"ID": "20230308095353-pj6v52x",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230308095353-pj6v52x",
		"title": "OCI镜像制作工具之skopeo",
		"updated": "20230308102716"
	},
	"Children": [
		{
			"ID": "20230308095353-j9mlshz",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230308095353-j9mlshz",
				"updated": "20230308095439"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1. skopeo简介"
				}
			]
		},
		{
			"ID": "20230308095448-84vm1e0",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230308095448-84vm1e0",
				"updated": "20230308095614"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1.1 简介"
				}
			]
		},
		{
			"ID": "20230308095615-xrtmxya",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095615-xrtmxya",
				"updated": "20230308095615"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "skopeo 是一个命令行工具，用于对容器镜像和镜像库执行各种操作，支持使用 OCI 镜像与原始的 Docker v2 镜像。可对容器镜像和容器存储进行操作。 在没有dockerd的环境下，使用 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "skopeo"
				},
				{
					"Type": "NodeText",
					"Data": " 操作镜像是非常方便的。Skopeo 能够在容器注册表上检查存储库并获取图片层。Inspect 命令获取存储库的清单，它能够向您显示关于整个存储库或标记的类似 docker inspect 的 json 输出。与 docker inspect 不同，这个工具可以帮助您在拉取存储库或标记之前(使用磁盘空间)收集有用的信息。Inspect 命令可以显示给定存储库可用的标记、图像的标签、图像的创建日期和操作系统等等。"
				}
			]
		},
		{
			"ID": "20230308095618-2ou1wtc",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230308095618-2ou1wtc",
				"updated": "20230308095623"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1.2 特性"
				}
			]
		},
		{
			"ID": "20230308095645-ug6p8tw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095645-ug6p8tw",
				"updated": "20230308095645"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "skopeo 使用 API V2 注册表，例如 Docker 注册表、Atomic 注册表、私有注册表、本地目录和本地 OCI 布局目录。skopeo\n不需要运行守护进程，它可以执行的操作包括："
				}
			]
		},
		{
			"ID": "20230308095645-7bden3y",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308095645-7bden3y",
				"updated": "20230308095645"
			},
			"Children": [
				{
					"ID": "20230308095645-raudtrx",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095645-raudtrx"
					},
					"Children": [
						{
							"ID": "20230308095645-aoyo2no",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095645-aoyo2no"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "通过各种存储机制复制镜像，例如，可以在不需要特权的情况下将镜像从一个注册表复制到另一个注册表"
								}
							]
						}
					]
				},
				{
					"ID": "20230308095645-q6mfzhy",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095645-q6mfzhy"
					},
					"Children": [
						{
							"ID": "20230308095645-0hj7gry",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095645-0hj7gry"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "检测远程镜像并查看其属性，包括其图层，无需将镜像拉到本地"
								}
							]
						}
					]
				},
				{
					"ID": "20230308095645-hhb73d9",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095645-hhb73d9"
					},
					"Children": [
						{
							"ID": "20230308095645-0e5s6kf",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095645-0e5s6kf"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "从镜像库中删除镜像"
								}
							]
						}
					]
				},
				{
					"ID": "20230308095645-7t4489c",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095645-7t4489c"
					},
					"Children": [
						{
							"ID": "20230308095645-khbfdo4",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095645-khbfdo4"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "当存储库需要时，skopeo 可以传递适当的凭据和证书进行身份验证"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095716-zqjjaih",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230308095716-zqjjaih",
				"updated": "20230308095724"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2. 安装"
				}
			]
		},
		{
			"ID": "20230308095716-pdtlr3q",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308095716-pdtlr3q",
				"updated": "20230308095716"
			},
			"Children": [
				{
					"ID": "20230308095716-9q2qf68",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095716-9q2qf68"
					},
					"Children": [
						{
							"ID": "20230308095716-gqp95ww",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095716-gqp95ww"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "RHEL/CentOS ≤ 7.x"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095716-w82kmwq",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095716-w82kmwq",
				"updated": "20230308095716"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "sudo yum -y install skopeo\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308095716-9swopt5",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308095716-9swopt5",
				"updated": "20230308095716"
			},
			"Children": [
				{
					"ID": "20230308095716-ef7vb8v",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095716-ef7vb8v"
					},
					"Children": [
						{
							"ID": "20230308095716-fyy27lz",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095716-fyy27lz"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "macOS"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095716-kxq0rgl",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095716-kxq0rgl",
				"updated": "20230308095716"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "brew install skopeo\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308095716-brt5q2z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095716-brt5q2z",
				"updated": "20230308095716"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "详细可参考："
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/containers/skopeo/blob/main/install.md",
					"TextMarkTextContent": "https://github.com/containers/skopeo/blob/main/install.md"
				}
			]
		},
		{
			"ID": "20230308095738-prkb3ro",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230308095738-prkb3ro",
				"updated": "20230308095744"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3. 使用案例"
				}
			]
		},
		{
			"ID": "20230308095755-h70ycfc",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095755-h70ycfc",
				"updated": "20230308095759"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ skopeo -h\nVarious operations with container images and container image registries\n\nUsage:\n  skopeo [flags]\n  skopeo [command]\n\nAvailable Commands:\n  copy                                          Copy an IMAGE-NAME from one location to another\n  delete                                        Delete image IMAGE-NAME\n  help                                          Help about any command\n  inspect                                       Inspect image IMAGE-NAME\n  list-tags                                     List tags in the transport/repository specified by the REPOSITORY-NAME\n  login                                         Login to a container registry\n  logout                                        Logout of a container registry\n  manifest-digest                               Compute a manifest digest of a file\n  standalone-sign                               Create a signature using local files\n  standalone-verify                             Verify a signature using local files\n  sync                                          Synchronize one or more images from one location to another\n\nFlags:\n      --command-timeout duration   timeout for the command execution\n      --debug                      enable debug output\n  -h, --help                       help for skopeo\n      --insecure-policy            run the tool without any policy check\n      --override-arch ARCH         use ARCH instead of the architecture of the machine for choosing images\n      --override-os OS             use OS instead of the running OS for choosing images\n      --override-variant VARIANT   use VARIANT instead of the running architecture variant for choosing images\n      --policy string              Path to a trust policy file\n      --registries.d DIR           use registry configuration files in DIR (e.g. for container signature storage)\n      --tmpdir string              directory used to store temporary files\n  -v, --version                    Version for Skopeo\n\nUse \"skopeo [command] --help\" for more information about a command.\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308100544-t6lr0du",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308100544-t6lr0du",
				"updated": "20230308100544"
			},
			"Children": [
				{
					"ID": "20230308100544-an1ghoh",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-an1ghoh"
					},
					"Children": [
						{
							"ID": "20230308100544-5p4alqd",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-5p4alqd"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "copy：复制一个镜像从 A 到 B，这里的 A 和 B 可以为本地 Docker 镜像或者 Registry 上的镜像；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-p7e3zbh",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-p7e3zbh"
					},
					"Children": [
						{
							"ID": "20230308100544-udfy5wg",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-udfy5wg"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "inspect：查看一个镜像的 manifest 或者 image config 详细信息；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-grmc2j1",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-grmc2j1"
					},
					"Children": [
						{
							"ID": "20230308100544-mnatlfx",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-mnatlfx"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "delete：删除一个镜像 tag，可以是本地 Docker 镜像或者 Registry 上的镜像；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-xp57ue3",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-xp57ue3"
					},
					"Children": [
						{
							"ID": "20230308100544-7e4kwcs",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-7e4kwcs"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "list-tags：列出一个 Registry 上某个镜像的所有 tag；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-srjm6j5",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-srjm6j5"
					},
					"Children": [
						{
							"ID": "20230308100544-csvj7ry",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-csvj7ry"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "login：登录到某个 Registry，和 docker login 类似；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-lyb3pa6",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-lyb3pa6"
					},
					"Children": [
						{
							"ID": "20230308100544-pyrkjrr",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-pyrkjrr"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "logout：退出已经登录到某个 Registry 的 auth 信息，和 docker logout 类似；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-r3eadvg",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-r3eadvg"
					},
					"Children": [
						{
							"ID": "20230308100544-4pzqa1r",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-4pzqa1r",
								"updated": "20230308100603"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "manifest-digest：计算一个文件的 sha256sum 值；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-50n00ve",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-50n00ve"
					},
					"Children": [
						{
							"ID": "20230308100544-4cztlni",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-4cztlni"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "standalone-sign、standalone-verify 这两个是和镜像加密相关的，使用的不是很多；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100544-x6fb5hy",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100544-x6fb5hy"
					},
					"Children": [
						{
							"ID": "20230308100544-mfhhov3",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100544-mfhhov3"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "sync：同步一个镜像从 A 到 B，感觉和 copy 一样，但 sync 支持的参数更多，功能更强大。"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100636-bww9cop",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100636-bww9cop"
					},
					"Children": [
						{
							"ID": "20230308100637-blldxv6",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100637-blldxv6"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "command-timeout：命令超时时间；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100637-xgd0s34",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100637-xgd0s34"
					},
					"Children": [
						{
							"ID": "20230308100637-za4trqx",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100637-za4trqx"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "insecure-policy：使用非安全的 policy，如果没有配置 policy 的话，需要加上该参数；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100637-jiey7ik",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100637-jiey7ik"
					},
					"Children": [
						{
							"ID": "20230308100637-ly6n4bt",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100637-ly6n4bt"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "override-arch：处理镜像时覆盖客户端 CPU 体系架构，如在 AMD64 的机器上用 Skopeo 处理 ARM64 的镜像；"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100637-8e2eenh",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100637-8e2eenh"
					},
					"Children": [
						{
							"ID": "20230308100637-549bwbl",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100637-549bwbl"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "override-os：处理镜像时覆盖客户端 OS。"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100637-h3n9s6d",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100637-h3n9s6d"
					},
					"Children": [
						{
							"ID": "20230308100637-0k70fjt",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100637-0k70fjt"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "debug：开启 debug 模式，输出详细的日志；"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308100736-h80ygtc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308100736-h80ygtc",
				"updated": "20230308100807"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": " 在使用insecure-policy时的一些参数"
				}
			]
		},
		{
			"ID": "20230308100746-oaopg3a",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308100746-oaopg3a",
				"updated": "20230308100746"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "--insecure-policy --src-tls-verify=false --dest-tls-verify=false\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308095840-d1lyplu",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308095840-d1lyplu",
				"updated": "20230308095840"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.1 检查存储库"
				}
			]
		},
		{
			"ID": "20230308095840-33d9o8o",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308095840-33d9o8o",
				"updated": "20230308095840"
			},
			"Children": [
				{
					"ID": "20230308095840-tvv9mxj",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095840-tvv9mxj"
					},
					"Children": [
						{
							"ID": "20230308095840-ca2llcg",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095840-ca2llcg"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "显示镜像属性"
								}
							]
						},
						{
							"ID": "20230308095840-ixa1fbg",
							"Type": "NodeList",
							"ListData": {},
							"Properties": {
								"id": "20230308095840-ixa1fbg"
							},
							"Children": [
								{
									"ID": "20230308095840-rdpd8t6",
									"Type": "NodeListItem",
									"ListData": {
										"BulletChar": 42,
										"Marker": "Kg=="
									},
									"Properties": {
										"id": "20230308095840-rdpd8t6"
									},
									"Children": [
										{
											"ID": "20230308095840-i3g4xm8",
											"Type": "NodeParagraph",
											"Properties": {
												"id": "20230308095840-i3g4xm8"
											},
											"Children": [
												{
													"Type": "NodeText",
													"Data": "远程仓库"
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095840-d2hx27b",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095840-d2hx27b",
				"updated": "20230308095840"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "docker://"
				},
				{
					"Type": "NodeText",
					"Data": ": 是使用 Docker Registry HTTP API V2 进行连接远端"
				}
			]
		},
		{
			"ID": "20230308095840-mgdh5i1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095840-mgdh5i1",
				"updated": "20230308095840"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "docker.io"
				},
				{
					"Type": "NodeText",
					"Data": ": 远程仓库"
				}
			]
		},
		{
			"ID": "20230308095840-kse9ek6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095840-kse9ek6",
				"updated": "20230308095840"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "fedora:latest"
				},
				{
					"Type": "NodeText",
					"Data": ": 镜像名称及tag"
				}
			]
		},
		{
			"ID": "20230308095919-ciz70u2",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095919-ciz70u2",
				"updated": "20230308095919"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "c2hlbGw="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ skopeo inspect docker://docker.io/fedora:latest\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308095919-ve8admv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308095919-ve8admv",
				"updated": "20230308095919"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "利用jq查看指定的信息。"
				}
			]
		},
		{
			"ID": "20230308095919-ciih1dx",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095919-ciih1dx",
				"updated": "20230308095919"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ skopeo inspect docker://registry.fedoraproject.org/fedora:latest | jq .Digest\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308100327-eszycow",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308100327-eszycow",
				"updated": "20230308100355"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "远程仓库也可以是如下面的其他类型："
				}
			]
		},
		{
			"ID": "20230308100406-04gqvpz",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308100406-04gqvpz",
				"updated": "20230308100443"
			},
			"Children": [
				{
					"ID": "20230308100443-p77uwuy",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100443-p77uwuy"
					},
					"Children": [
						{
							"ID": "20230308100443-hops4up",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100443-hops4up"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "atomic"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308100429-f8s5xb1",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308100429-f8s5xb1"
			},
			"Children": [
				{
					"ID": "20230308100406-nv3evu6",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-nv3evu6"
					},
					"Children": [
						{
							"ID": "20230308100406-mel1k5d",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-mel1k5d"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "containers-storage"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-y0gl9zo",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-y0gl9zo"
					},
					"Children": [
						{
							"ID": "20230308100406-wspipme",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-wspipme"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "dir"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-39iorle",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-39iorle"
					},
					"Children": [
						{
							"ID": "20230308100406-vyll6o0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-vyll6o0"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "docker"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-v2j1v24",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-v2j1v24"
					},
					"Children": [
						{
							"ID": "20230308100406-vuefy28",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-vuefy28"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "docker-daemon"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-kt0dsw5",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-kt0dsw5"
					},
					"Children": [
						{
							"ID": "20230308100406-jveocbu",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-jveocbu"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "docker-tar"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-digef45",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-digef45"
					},
					"Children": [
						{
							"ID": "20230308100406-zt6bax3",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-zt6bax3"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "oci"
								}
							]
						}
					]
				},
				{
					"ID": "20230308100406-8exk8a8",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308100406-8exk8a8"
					},
					"Children": [
						{
							"ID": "20230308100406-zo5bamq",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308100406-zo5bamq"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "ostree"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095947-8o4g86z",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308095947-8o4g86z",
				"updated": "20230308095947"
			},
			"Children": [
				{
					"ID": "20230308095947-hvlirdx",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308095947-hvlirdx"
					},
					"Children": [
						{
							"ID": "20230308095947-cdeu93q",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308095947-cdeu93q"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "查看本地镜像"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308095947-pt4ft1g",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308095947-pt4ft1g",
				"updated": "20230308095947"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "c2hlbGw="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ skopeo inspect docker-daemon:mysql:8.0.19\n{\n    \"Name\": \"docker.io/library/mysql\",\n    \"Digest\": \"sha256:8084d869573a2e1be9d49d1b8dea49b54fc43301a3ead4b8124eedb809cf3c3f\",\n    \"RepoTags\": [],\n    \"Created\": \"2020-04-23T04:14:55.648457026Z\",\n    \"DockerVersion\": \"18.09.7\",\n    \"Labels\": null,\n    \"Architecture\": \"amd64\",\n    \"Os\": \"linux\",\n    \"Layers\": [\n        \"sha256:c2adabaecedbda0af72b153c6499a0555f3a769d52370469d8f6bd6328af9b13\",\n        \"sha256:49003fe88142d189c33a6e52b97081c8d62b67e0d04e9e7421ca6a2495b0d766\",\n        \"sha256:8d3b3830445d713c580008a547de7398ab721a083fda915526ce2cc557c4f40a\",\n        \"sha256:49baacc63c3bb5a7ab5077ef6458d6e246710195d7794cb704940f3a40495c23\",\n        \"sha256:24bd91e7be374167e51e37faa31e7ce143921afb0b968415c749625319386fdb\",\n        \"sha256:d84f8cf1dc236ea2ddbc0393b0c33099bedb20fffbe68bdf170d2df161a1ca16\",\n        \"sha256:ace74cb61ec0a3fd2847dc3a0b8b0cad349c95ce02732982e258fc1a337d073f\",\n        \"sha256:ba6f785586f5ff477e87528a5d2c8d0215e22f5b9ac3a8f4b19a033cad7aa832\",\n        \"sha256:c861c8d6e01539cc5b27fe773aca63958bc361391f6a980ece5322fd8dbca296\",\n        \"sha256:1ac7b6bb690abc8073c2193635afb06b8494d2d0024dc08310b296975f92bb61\",\n        \"sha256:b8e742ca24b882430bf4a6075aa97a8c1e8809f6e59d462cba05bec49d817ff3\",\n        \"sha256:7fc1a766ce1413db3d5fceb7256c1e54639386673c24eadaf69b429b07eb9223\"\n    ],\n    \"Env\": [\n        \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n        \"GOSU_VERSION=1.12\",\n        \"MYSQL_MAJOR=8.0\",\n        \"MYSQL_VERSION=8.0.19-1debian10\"\n    ]\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308100008-jaz9xt6",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308100008-jaz9xt6",
				"updated": "20230308100008"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.2 拷贝镜像"
				}
			]
		},
		{
			"ID": "20230308100008-ymox8ch",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308100008-ymox8ch",
				"updated": "20230308100008"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在不使用 docker 的情况下从远端下载镜像"
				}
			]
		},
		{
			"ID": "20230308100008-hcm39wt",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308100008-hcm39wt",
				"updated": "20230308101456"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "c2hlbGw="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# 下载远程镜像到/tmp/下，命名为nginx.tar\nskopeo --insecure-policy copy docker://nginx:1.17.6 docker-archive:/tmp/nginx.tar\n\n# 将本地tar镜像文件导入到docker中\nskopeo copy docker-archive:/tmp/nginx.tar docker-daemon:nginx:latest\n\n#将一个镜像从 Registry 中同步到本地目录：\n$ skopeo sync --src docker --dest dir k8s.gcr.io/pause:3.3 images\nimages\n└── pause:3.3\n    ├── 0184c1613d92931126feb4c548e5da11015513b9e4c104e7305ee8b53b50a9da\n    ├── aeab776c48375e1a61810a0a5f59e982e34425ff505a01c2b57dcedc6799c17b\n    ├── manifest.json\n    └── version\n\n#将镜像从本地目录同步到 Registry 中：\n$ skopeo sync --src dir --dest docker images hub.k8s.li\nINFO[0000] Copying image ref 1/1                         from=\"dir:images/pause:3.3\" to=\"docker://hub.k8s.li/pause:3.3\"\nGetting image source signatures\nCopying blob aeab776c4837 [--------------------------------------] 0.0b / 0.0b\nCopying config 0184c1613d done\nWriting manifest to image destination\nStoring signatures\nINFO[0002] Synced 1 images from 1 sources\n\n#将镜从 Registry A 同步到 Registry B：\n$ skopeo sync --src docker --dest docker k8s.gcr.io/pause:3.3 hub.k8s.li\nINFO[0000] Tag presence check                            imagename=\"k8s.gcr.io/pause:3.3\" tagged=true\nINFO[0000] Copying image tag 1/1                         from=\"docker://k8s.gcr.io/pause:3.3\" to=\"docker://hub.k8s.li/pause:3.3\"\nGetting image source signatures\nCopying blob aeab776c4837 done\nCopying config 0184c1613d done\nWriting manifest to image destination\nStoring signatures\nINFO[0000] Synced 1 images from 1 sources\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308100029-zs6r5ve",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308100029-zs6r5ve",
				"updated": "20230308100029"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.3 删除镜像"
				}
			]
		},
		{
			"ID": "20230308100029-o2fiia2",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308100029-o2fiia2",
				"updated": "20230308100029"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "skopeo delete docker://localhost:5000/nginx:latest\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308100043-e6oyq5p",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308100043-e6oyq5p",
				"updated": "20230308100043"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.4 注册表认证"
				}
			]
		},
		{
			"ID": "20230308100043-depcon7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308100043-depcon7",
				"updated": "20230308100043"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "认证文件默认存放在"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "$HOME/.docker/config.json"
				}
			]
		},
		{
			"ID": "20230308100043-97t01s7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308100043-97t01s7",
				"updated": "20230308100043"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "文件内容"
				}
			]
		},
		{
			"ID": "20230308100043-f1hwhob",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308100043-f1hwhob",
				"updated": "20230308100043"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "{\n\t\"auths\": {\n\t\t\"myregistrydomain.com:5000\": {\n\t\t\t\"auth\": \"dGVzdHVzZXI6dGVzdHBhc3N3b3Jk\",\n\t\t\t\"email\": \"stuf@ex.cm\"\n\t\t}\n\t}\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308101121-wfkk7mq",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230308101121-wfkk7mq",
				"updated": "20230308101158"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.5 列出 Registry 上的某个镜像的所有 tag"
				}
			]
		},
		{
			"ID": "20230308101201-cyqqxg0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308101201-cyqqxg0",
				"updated": "20230308101203"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "skopeo list-tags"
				}
			]
		},
		{
			"ID": "20230308101133-bzj12lz",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308101133-bzj12lz",
				"updated": "20230308101146"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ skopeo list-tags docker://k8s.gcr.io/pause\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308101810-9dwd5nb",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230308101810-9dwd5nb",
				"updated": "20230308101824"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.6 批量同步镜像"
				}
			]
		},
		{
			"ID": "20230308102139-ogj34lb",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308102139-ogj34lb",
				"updated": "20230308102259"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.6.1 同步镜像从一个 Registry 同步到另一个 Registry"
				}
			]
		},
		{
			"ID": "20230308101824-veirdcc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308101824-veirdcc",
				"updated": "20230308101842"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "镜像列表示例：images-list.txt"
				}
			]
		},
		{
			"ID": "20230308101900-ftdbf27",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308101900-ftdbf27",
				"updated": "20230308101902"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "##k8s-images\nkubesphere/kube-apiserver:v1.20.6\nkubesphere/kube-scheduler:v1.20.6\nkubesphere/kube-proxy:v1.20.6\nkubesphere/kube-controller-manager:v1.20.6\nkubesphere/kube-apiserver:v1.19.8\nkubesphere/kube-scheduler:v1.19.8\nkubesphere/kube-proxy:v1.19.8\nkubesphere/kube-controller-manager:v1.19.8\nkubesphere/kube-apiserver:v1.19.9\nkubesphere/kube-scheduler:v1.19.9\nkubesphere/kube-proxy:v1.19.9\nkubesphere/kube-controller-manager:v1.19.9\nkubesphere/kube-apiserver:v1.18.8\nkubesphere/kube-scheduler:v1.18.8\nkubesphere/kube-proxy:v1.18.8\nkubesphere/kube-controller-manager:v1.18.8\nkubesphere/kube-apiserver:v1.17.9\nkubesphere/kube-scheduler:v1.17.9\nkubesphere/kube-proxy:v1.17.9\nkubesphere/kube-controller-manager:v1.17.9\nkubesphere/pause:3.1\nkubesphere/pause:3.2\nkubesphere/etcd:v3.4.13\ncalico/cni:v3.16.3\ncalico/kube-controllers:v3.16.3\ncalico/node:v3.16.3\ncalico/pod2daemon-flexvol:v3.16.3\ncalico/typha:v3.16.3\nkubesphere/flannel:v0.12.0\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308101953-eno55br",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308101953-eno55br",
				"updated": "20230308101953"
			},
			"Children": [
				{
					"ID": "20230308101953-b1m3mki",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308101953-b1m3mki",
						"updated": "20230308101953"
					},
					"Children": [
						{
							"ID": "20230308101953-zudlrlm",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308101953-zudlrlm",
								"updated": "20230308101953"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "sync.sh"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308101938-qacqxl2",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308101938-qacqxl2",
				"updated": "20230308101940"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "#!/bin/bash\nGREEN_COL=\"\\\\033[32;1m\"\nRED_COL=\"\\\\033[1;31m\"\nNORMAL_COL=\"\\\\033[0;39m\"\n\nSOURCE_REGISTRY=$1\nTARGET_REGISTRY=$2\n\n: ${IMAGES_LIST_FILE:=\"images-list.txt\"}\n: ${TARGET_REGISTRY:=\"hub.k8s.li\"}\n: ${SOURCE_REGISTRY:=\"docker.io\"}\n\nBLOBS_PATH=\"docker/registry/v2/blobs/sha256\"\nREPO_PATH=\"docker/registry/v2/repositories\"\n\nset -eo pipefail\n\nCURRENT_NUM=0\nALL_IMAGES=\"$(sed -n '/#/d;s/:/:/p' ${IMAGES_LIST_FILE} | sort -u)\"\nTOTAL_NUMS=$(echo \"${ALL_IMAGES}\" | wc -l)\n\nskopeo_copy() {\n if skopeo copy --insecure-policy --src-tls-verify=false --dest-tls-verify=false \\\n --override-arch amd64 --override-os linux -q docker://$1 docker://$2; then\n echo -e \"$GREEN_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 successful $NORMAL_COL\"\n else\n echo -e \"$RED_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 failed $NORMAL_COL\"\n exit 2\n fi\n}\n\nfor image in ${ALL_IMAGES}; do\n let CURRENT_NUM=${CURRENT_NUM}+1\n skopeo_copy ${SOURCE_REGISTRY}/${image} ${TARGET_REGISTRY}/${image}\ndone\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102029-07v0nh7",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308102029-07v0nh7",
				"updated": "20230308102029"
			},
			"Children": [
				{
					"ID": "20230308102029-z1x7j3q",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308102029-z1x7j3q"
					},
					"Children": [
						{
							"ID": "20230308102029-sdkbeee",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308102029-sdkbeee"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "bash sync.sh docker.io localhost:5000"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308102118-zf51v36",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308102118-zf51v36",
				"updated": "20230308102133"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ bash sync.sh docker.io localhost:5000\nProgress: 1/143 sync docker.io/alpine:3.14 to localhost:5000/alpine:3.14 successful\nProgress: 2/143 sync docker.io/busybox:1.31.1 to localhost:5000/busybox:1.31.1 successful\nProgress: 3/143 sync docker.io/calico/cni:v3.16.3 to localhost:5000/calico/cni:v3.16.3 successful\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102246-1qvomes",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308102246-1qvomes",
				"updated": "20230308102315"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.6.2 从 Registry 中同步到本地目录"
				}
			]
		},
		{
			"ID": "20230308102325-ne6cr0d",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308102325-ne6cr0d",
				"updated": "20230308102328"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "#!/bin/bash\nGREEN_COL=\"\\\\033[32;1m\"\nRED_COL=\"\\\\033[1;31m\"\nNORMAL_COL=\"\\\\033[0;39m\"\n\nSOURCE_REGISTRY=$1\nTARGET_REGISTRY=$2\nIMAGES_DIR=$2\n\n: ${IMAGES_DIR:=\"images\"}\n: ${IMAGES_LIST_FILE:=\"images-list.txt\"}\n: ${TARGET_REGISTRY:=\"hub.k8s.li\"}\n: ${SOURCE_REGISTRY:=\"docker.io\"}\n\nBLOBS_PATH=\"docker/registry/v2/blobs/sha256\"\nREPO_PATH=\"docker/registry/v2/repositories\"\n\nset -eo pipefail\n\nCURRENT_NUM=0\nALL_IMAGES=\"$(sed -n '/#/d;s/:/:/p' ${IMAGES_LIST_FILE} | sort -u)\"\nTOTAL_NUMS=$(echo \"${ALL_IMAGES}\" | wc -l)\n\nskopeo_sync() {\n if skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \\\n --override-arch amd64 --override-os linux --src docker --dest dir $1 $2 \u003e /dev/null; then\n echo -e \"$GREEN_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 successful $NORMAL_COL\"\n else\n echo -e \"$RED_COL Progress: ${CURRENT_NUM}/${TOTAL_NUMS} sync $1 to $2 failed $NORMAL_COL\"\n exit 2\n fi\n}\n\nconvert_images() {\n rm -rf ${IMAGES_DIR}; mkdir -p ${IMAGES_DIR}\n for image in ${ALL_IMAGES}; do\n let CURRENT_NUM=${CURRENT_NUM}+1\n image_name=${image%%:*}\n image_tag=${image##*:}\n image_repo=${image%%/*}\n skopeo_sync ${SOURCE_REGISTRY}/${image} ${IMAGES_DIR}/${image_repo}\n manifest=\"${IMAGES_DIR}/${image}/manifest.json\"\n manifest_sha256=$(sha256sum ${manifest} | awk '{print $1}')\n mkdir -p ${BLOBS_PATH}/${manifest_sha256:0:2}/${manifest_sha256}\n ln -f ${manifest} ${BLOBS_PATH}/${manifest_sha256:0:2}/${manifest_sha256}/data\n\n # make image repositories dir\n mkdir -p ${REPO_PATH}/${image_name}/{_uploads,_layers,_manifests}\n mkdir -p ${REPO_PATH}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}\n mkdir -p ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/{current,index/sha256}\n mkdir -p ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}\n\n # create image tag manifest link file\n echo -n \"sha256:${manifest_sha256}\" \u003e ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/current/link\n echo -n \"sha256:${manifest_sha256}\" \u003e ${REPO_PATH}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}/link\n echo -n \"sha256:${manifest_sha256}\" \u003e ${REPO_PATH}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}/link\n\n # link image layers file to registry blobs dir\n for layer in $(sed '/v1Compatibility/d' ${manifest} | grep -Eo \"\\b[a-f0-9]{64}\\b\"); do\n mkdir -p ${BLOBS_PATH}/${layer:0:2}/${layer}\n mkdir -p ${REPO_PATH}/${image_name}/_layers/sha256/${layer}\n echo -n \"sha256:${layer}\" \u003e ${REPO_PATH}/${image_name}/_layers/sha256/${layer}/link\n ln -f ${IMAGES_DIR}/${image}/${layer} ${BLOBS_PATH}/${layer:0:2}/${layer}/data\n done\n done\n}\n\nconvert_images\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102342-0kngowr",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308102342-0kngowr",
				"updated": "20230308102342"
			},
			"Children": [
				{
					"ID": "20230308102342-1ce95cw",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308102342-1ce95cw"
					},
					"Children": [
						{
							"ID": "20230308102342-my7l0zt",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308102342-my7l0zt"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "install.sh"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308102351-oxmzy84",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308102351-oxmzy84",
				"updated": "20230308102352"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用这个脚本将 Registry 存储中的镜像转换成 skopeo dir 的方式，然后再将镜像同步到 Registry 中"
				}
			]
		},
		{
			"ID": "20230308102357-8ettakd",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308102357-8ettakd",
				"updated": "20230308102359"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "#!/bin/bash\nREGISTRY_DOMAIN=\"harbor.k8s.li\"\nREGISTRY_PATH=\"/var/lib/registry\"\n\n# 切换到 registry 存储主目录下\ncd ${REGISTRY_PATH}\n\ngen_skopeo_dir() {\n   # 定义 registry 存储的 blob 目录 和 repositories 目录，方便后面使用\n    BLOB_DIR=\"docker/registry/v2/blobs/sha256\"\n    REPO_DIR=\"docker/registry/v2/repositories\"\n    # 定义生成 skopeo 目录\n    SKOPEO_DIR=\"docker/skopeo\"\n    # 通过 find 出 current 文件夹可以得到所有带 tag 的镜像，因为一个 tag 对应一个 current 目录\n    for image in $(find ${REPO_DIR} -type d -name \"current\"); do\n        # 根据镜像的 tag 提取镜像的名字\n        name=$(echo ${image} | awk -F '/' '{print $5\"/\"$6\":\"$9}')\n        link=$(cat ${image}/link | sed 's/sha256://')\n        mfs=\"${BLOB_DIR}/${link:0:2}/${link}/data\"\n        # 创建镜像的硬链接需要的目录\n        mkdir -p \"${SKOPEO_DIR}/${name}\"\n        # 硬链接镜像的 manifests 文件到目录的 manifest 文件\n        ln ${mfs} ${SKOPEO_DIR}/${name}/manifest.json\n        # 使用正则匹配出所有的 sha256 值，然后排序去重\n        layers=$(grep -Eo \"\\b[a-f0-9]{64}\\b\" ${mfs} | sort -n | uniq)\n        for layer in ${layers}; do\n          # 硬链接 registry 存储目录里的镜像 layer 和 images config 到镜像的 dir 目录\n            ln ${BLOB_DIR}/${layer:0:2}/${layer}/data ${SKOPEO_DIR}/${name}/${layer}\n        done\n    done\n}\n\nsync_image() {\n    # 使用 skopeo sync 将 dir 格式的镜像同步到 harbor\n    for project in $(ls ${SKOPEO_DIR}); do\n        skopeo sync --insecure-policy --src-tls-verify=false --dest-tls-verify=false \\\n        --src dir --dest docker ${SKOPEO_DIR}/${project} ${REGISTRY_DOMAIN}/${project}\n    done\n}\n\ngen_skopeo_dir\nsync_image\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102355-7z6rmhf",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230308102355-7z6rmhf",
				"updated": "20230308102515"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.6.3 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "从 Registry 存储中 select 出镜像"
				}
			]
		},
		{
			"ID": "20230308102519-lablscf",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308102519-lablscf",
				"updated": "20230308102533"
			},
			"Children": [
				{
					"ID": "20230308102533-i0moxqh",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308102533-i0moxqh"
					},
					"Children": [
						{
							"ID": "20230308102533-gd4sc7w",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308102533-gd4sc7w"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "先将镜像同步到一个固定的 Registry 中"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308102537-b0ac6c5",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308102537-b0ac6c5",
				"updated": "20230308102537"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YXNjcmlwdA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ bash sync.sh docker.io localhost:5000\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102541-3un5b6n",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230308102541-3un5b6n",
				"updated": "20230308102553"
			},
			"Children": [
				{
					"ID": "20230308102543-fwb7j0n",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230308102543-fwb7j0n",
						"updated": "20230308102553"
					},
					"Children": [
						{
							"ID": "20230308102544-2zh5s6c",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230308102544-2zh5s6c",
								"updated": "20230308102553"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": " 再使用该脚本将镜像从 Registry 存储中捞出来："
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230308102602-9mt99us",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230308102602-9mt99us",
				"updated": "20230308102604"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "XA=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "#!/bin/bash\nset -eo pipefail\n\nIMAGES_LIST=\"$1\"\nREGISTRY_PATH=\"$2\"\nOUTPUT_DIR=\"$3\"\nBLOB_DIR=\"docker/registry/v2/blobs/sha256\"\nREPO_DIR=\"docker/registry/v2/repositories\"\n\nrm -rf ${OUTPUT_DIR}; mkdir -p ${OUTPUT_DIR}\nfor image in $(find ${IMAGES_LIST} -type f -name \"*.list\" | xargs grep -Ev '^#|^/' | grep ':'); do\n    image_tag=${image##*:}\n    image_name=${image%%:*}\n    tag_link=${REGISTRY_PATH}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/current/link\n    manifest_sha256=$(sed 's/sha256://' ${tag_link})\n    manifest=${REGISTRY_PATH}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}/data\n    mkdir -p ${OUTPUT_DIR}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}\n    ln -f ${manifest} ${OUTPUT_DIR}/${BLOB_DIR}/${manifest_sha256:0:2}/${manifest_sha256}/data\n\n    # make image repositories dir\n    mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/{_uploads,_layers,_manifests}\n    mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}\n    mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/{current,index/sha256}\n    mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}\n\n    # create image tag manifest link file\n    echo -n \"sha256:${manifest_sha256}\" \u003e ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/current/link\n    echo -n \"sha256:${manifest_sha256}\" \u003e ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/revisions/sha256/${manifest_sha256}/link\n    echo -n \"sha256:${manifest_sha256}\" \u003e ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_manifests/tags/${image_tag}/index/sha256/${manifest_sha256}/link\n    for layer in $(sed '/v1Compatibility/d' ${manifest} | grep -Eo '\\b[a-f0-9]{64}\\b' | sort -u); do\n        mkdir -p ${OUTPUT_DIR}/${BLOB_DIR}/${layer:0:2}/${layer}\n        mkdir -p ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_layers/sha256/${layer}\n        ln -f ${BLOB_DIR}/${layer:0:2}/${layer}/data ${OUTPUT_DIR}/${BLOB_DIR}/${layer:0:2}/${layer}/data\n        echo -n \"sha256:${layer}\" \u003e ${OUTPUT_DIR}/${REPO_DIR}/${image_name}/_layers/sha256/${layer}/link\n    done\ndone\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230308102652-mkl6rld",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230308102652-mkl6rld",
				"updated": "20230308102716"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4.参考链接："
				}
			]
		},
		{
			"ID": "20230308102709-fe4iojv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308102709-fe4iojv",
				"updated": "20230308102709"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "https://cloud.tencent.com/developer/article/1851464"
				}
			]
		},
		{
			"ID": "20230308102712-vcz9vb2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230308102712-vcz9vb2",
				"updated": "20230308102712"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "https://bbs.huaweicloud.com/blogs/344975"
				}
			]
		}
	]
}