{
	"ID": "20230626084656-vh5mpma",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230626084656-vh5mpma",
		"title": "switch_root、chroot与pivot_root总结",
		"updated": "20230626085950"
	},
	"Children": [
		{
			"ID": "20230626084656-pm6i9qe",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230626084656-pm6i9qe",
				"updated": "20230626084826"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "switch_root"
				}
			]
		},
		{
			"ID": "20230626084817-hf91jmv",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230626084817-hf91jmv",
				"updated": "20230626084829"
			},
			"Children": [
				{
					"ID": "20230626084829-47zb0uz",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626084829-47zb0uz",
						"updated": "20230626084829"
					},
					"Children": [
						{
							"ID": "20230626084829-rptrdum",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626084829-rptrdum",
								"updated": "20230626084902"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "switch_root 机制目的"
								}
							]
						},
						{
							"ID": "20230626084902-sy47etw",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626084902-sy47etw"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "专为initramfs设计, 通常initramfs都是为了安装最终的根文件系统做准备工作，然后切换到新的根文件系统上去。"
								}
							]
						},
						{
							"ID": "20230626084911-uld6rfp",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626084911-uld6rfp"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": " initramfs 是rootfs， 且不能umount， 所以不能使用pivot_root."
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230626084817-76yt3ge",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230626084817-76yt3ge",
				"updated": "20230626085217"
			},
			"Children": [
				{
					"ID": "20230626084836-5nck92a",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626084836-5nck92a",
						"updated": "20230626085217"
					},
					"Children": [
						{
							"ID": "20230626084836-uy99b2s",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626084836-uy99b2s",
								"updated": "20230626084836"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "switch_root做的工作："
								}
							]
						},
						{
							"ID": "20230626084846-dvxk1i7",
							"Type": "NodeList",
							"ListData": {
								"Typ": 1
							},
							"Properties": {
								"id": "20230626084846-dvxk1i7",
								"updated": "20230626085217"
							},
							"Children": [
								{
									"ID": "20230626084848-qv0ih9l",
									"Type": "NodeListItem",
									"ListData": {
										"Typ": 1,
										"Delimiter": 46,
										"Marker": "MS4=",
										"Num": 1
									},
									"Properties": {
										"id": "20230626084848-qv0ih9l",
										"updated": "20230626084848"
									},
									"Children": [
										{
											"ID": "20230626084848-t0zr5dy",
											"Type": "NodeParagraph",
											"Properties": {
												"id": "20230626084848-t0zr5dy",
												"updated": "20230626084848"
											},
											"Children": [
												{
													"Type": "NodeText",
													"Data": "删除早的rootfs内的全部内容，目的是为了释放空间，因为用的内存空间."
												}
											]
										}
									]
								},
								{
									"ID": "20230626084853-ps8rufy",
									"Type": "NodeListItem",
									"ListData": {
										"Typ": 1,
										"Delimiter": 46,
										"Marker": "Mi4=",
										"Num": 2
									},
									"Properties": {
										"id": "20230626084853-ps8rufy"
									},
									"Children": [
										{
											"ID": "20230626084853-ie4vl4w",
											"Type": "NodeParagraph",
											"Properties": {
												"id": "20230626084853-ie4vl4w"
											},
											"Children": [
												{
													"Type": "NodeText",
													"Data": "安装新的根文件系统."
												}
											]
										}
									]
								},
								{
									"ID": "20230626084859-kydnan5",
									"Type": "NodeListItem",
									"ListData": {
										"Typ": 1,
										"Delimiter": 46,
										"Marker": "My4=",
										"Num": 3
									},
									"Properties": {
										"id": "20230626084859-kydnan5",
										"updated": "20230626085217"
									},
									"Children": [
										{
											"ID": "20230626084859-zeaonmp",
											"Type": "NodeParagraph",
											"Properties": {
												"id": "20230626084859-zeaonmp"
											},
											"Children": [
												{
													"Type": "NodeText",
													"Data": "切换到新的文件系统，并执行新文件系统的init程序.\n（switch_root必须由pid=1的进程调用，否则会错误，例如在init脚本: exec switch_root new_rootfs  /init"
												}
											]
										},
										{
											"ID": "20230626085212-4ajwrfm",
											"Type": "NodeParagraph",
											"Properties": {
												"id": "20230626085212-4ajwrfm",
												"updated": "20230626085217"
											},
											"Children": [
												{
													"Type": "NodeText",
													"Data": "  init脚本调用switch_root命令必须用exec命令调用，否则也会出错，提示：\nswitch_root: not rootfs）"
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230626084816-qxfyhms",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230626084816-qxfyhms",
				"updated": "20230626085743"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "pivot_root"
				}
			]
		},
		{
			"ID": "20230626085747-6ugj197",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230626085747-6ugj197",
				"updated": "20230626085950"
			},
			"Children": [
				{
					"ID": "20230626085801-2wy9ght",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626085801-2wy9ght",
						"updated": "20230626085801"
					},
					"Children": [
						{
							"ID": "20230626085801-53hg5vs",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626085801-53hg5vs",
								"updated": "20230626085820"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "pivot_root 机制目的\n改变当前工作目录的所有进程或线程的工作目录. 这个跟chroot的就有很大的区别，chroot是只改变即将运行的\n某进程的根目录。pviot_root主要是把整个系统切换到一个新的root目录，然后去掉对之前rootfs的依赖，以便于可以umount之前的文件系统（pivot_root需要root权限）"
								}
							]
						}
					]
				},
				{
					"ID": "20230626085946-egj1aei",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626085946-egj1aei",
						"updated": "20230626085950"
					},
					"Children": [
						{
							"ID": "20230626085950-9w1itep",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626085950-9w1itep",
								"updated": "20230626085950"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "​"
								},
								{
									"Type": "NodeImage",
									"Data": "span",
									"Children": [
										{
											"Type": "NodeBang"
										},
										{
											"Type": "NodeOpenBracket"
										},
										{
											"Type": "NodeLinkText",
											"Data": "image"
										},
										{
											"Type": "NodeCloseBracket"
										},
										{
											"Type": "NodeOpenParen"
										},
										{
											"Type": "NodeLinkDest",
											"Data": "assets/image-20230626085950-r6n03js.png"
										},
										{
											"Type": "NodeCloseParen"
										}
									]
								},
								{
									"Type": "NodeText",
									"Data": "​"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230626085822-fmsaash",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230626085822-fmsaash",
				"updated": "20230626085825"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "chroot"
				}
			]
		},
		{
			"ID": "20230626085838-515ujpy",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230626085838-515ujpy",
				"updated": "20230626085841"
			},
			"Children": [
				{
					"ID": "20230626085841-7q3abmo",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626085841-7q3abmo",
						"updated": "20230626085841"
					},
					"Children": [
						{
							"ID": "20230626085841-rdvhywp",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626085841-rdvhywp",
								"updated": "20230626085841"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "chroot 机制目的\n为了进一步提高系统的安全性，linux引入了chroot机制，chroot是一个系统调用,可以更改一个进程所能看到的根目录。\n类似创建一个沙盒，进程运行在沙盒之内，进程运行正常与否，并不会影响这个台器的其他进程。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230626085838-xce0tas",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230626085838-xce0tas",
				"updated": "20230626085858"
			},
			"Children": [
				{
					"ID": "20230626085849-7tu9h4y",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230626085849-7tu9h4y",
						"updated": "20230626085858"
					},
					"Children": [
						{
							"ID": "20230626085849-rxrb48n",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230626085849-rxrb48n",
								"updated": "20230626085858"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "chroot（change to root）\n改变根目录，也就是改变一个程序运行时参考的根目录位置。例如:\n ​"
								},
								{
									"Type": "NodeImage",
									"Data": "span",
									"Children": [
										{
											"Type": "NodeBang"
										},
										{
											"Type": "NodeOpenBracket"
										},
										{
											"Type": "NodeLinkText",
											"Data": "image"
										},
										{
											"Type": "NodeCloseBracket"
										},
										{
											"Type": "NodeOpenParen"
										},
										{
											"Type": "NodeLinkDest",
											"Data": "assets/image-20230626085858-sox2qos.png"
										},
										{
											"Type": "NodeCloseParen"
										}
									]
								},
								{
									"Type": "NodeText",
									"Data": "​"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230626085856-ohr96ho",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230626085856-ohr96ho"
			}
		}
	]
}