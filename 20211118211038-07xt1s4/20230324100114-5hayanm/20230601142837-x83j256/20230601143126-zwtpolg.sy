{
	"ID": "20230601143126-zwtpolg",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230601143126-zwtpolg",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20230601143126-7bnygiv\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230601143430-hjngcj9\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230601143430-hjngcj9\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0}",
		"title": "saltstack key认证过程 ",
		"updated": "20230601143430"
	},
	"Children": [
		{
			"ID": "20230601143126-7bnygiv",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20230601143126-7bnygiv",
				"updated": "20230601143126"
			}
		},
		{
			"ID": "20230601143126-bkv86th",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-bkv86th",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-sw8xv62",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-sw8xv62",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-xc8588b",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-xc8588b",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://www.cnblogs.com/tyrone-y/p/9071073.html",
									"TextMarkTextContent": "https://www.cnblogs.com/tyrone-y/p/9071073.html"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-u576moj",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20230601143126-u576moj",
				"updated": "20230601143126"
			}
		},
		{
			"ID": "20230601143126-vox8kgn",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230601143126-vox8kgn",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "密钥对儿的认证"
				}
			]
		},
		{
			"ID": "20230601143126-k7iwurk",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-k7iwurk",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当初始化安装 minion 启动服务启动后"
				}
			]
		},
		{
			"ID": "20230601143126-gxohvf2",
			"Type": "NodeList",
			"ListData": {
				"Typ": 1
			},
			"Properties": {
				"id": "20230601143126-gxohvf2",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-uuayrdg",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "MS4=",
						"Num": 1
					},
					"Properties": {
						"id": "20230601143126-uuayrdg",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-4er4g1o",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-4er4g1o",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "minion端生成一个秘钥对，并产生一个ID值，minion服务会安装ID值命名的公钥发送给 master ,直到接受为止;"
								}
							]
						}
					]
				},
				{
					"ID": "20230601143126-2sspxp7",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Mi4=",
						"Num": 2
					},
					"Properties": {
						"id": "20230601143126-2sspxp7",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-0kn1ecj",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-0kn1ecj",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master认证完毕后，会将minion 端发送来的，以ID值命名的公钥存放在 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/salt/pki/master/minions"
								},
								{
									"Type": "NodeText",
									"Data": "​ 目录中(无扩展名);"
								}
							]
						}
					]
				},
				{
					"ID": "20230601143126-1674dlk",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "My4=",
						"Num": 3
					},
					"Properties": {
						"id": "20230601143126-1674dlk",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-i6enlcg",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-i6enlcg",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master认证完毕后，会将自身的公钥发送给 minion，并存储为 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/salt/pki/minion/minion_master.pub"
								},
								{
									"Type": "NodeText",
									"Data": "​"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-xdw3o76",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20230601143126-xdw3o76",
				"updated": "20230601143126"
			}
		},
		{
			"ID": "20230601143126-cutffyr",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230601143126-cutffyr",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "minion id的生成过程"
				}
			]
		},
		{
			"ID": "20230601143126-nbqu8uy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-nbqu8uy",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "minion 默认按照一定的顺序，试图找到一个不是localhost的值作为其ID"
				}
			]
		},
		{
			"ID": "20230601143126-rltcpxa",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-rltcpxa",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "这里不需要知道salt是按照怎样的顺序取值的，只需要记住以下优先级即可"
				}
			]
		},
		{
			"ID": "20230601143126-7alqbvv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-7alqbvv",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "hostname"
				},
				{
					"Type": "NodeText",
					"Data": "​ \u003c "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "/etc/salt/minion_id"
				},
				{
					"Type": "NodeText",
					"Data": "​ \u003c "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "/etc/salt/minion文件中的id值"
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230601143126-2big438",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20230601143126-2big438",
				"updated": "20230601143126"
			}
		},
		{
			"ID": "20230601143126-0uf77iq",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230601143126-0uf77iq",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "密钥对儿存放的位置"
				}
			]
		},
		{
			"ID": "20230601143126-jgovkyg",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-jgovkyg",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-vfl7h68",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-vfl7h68",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-3kkysz5",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-3kkysz5",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master 秘钥对默认存储在"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-sr64vlb",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-sr64vlb",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/etc/salt/pki/master/master.pub \n/etc/salt/pki/master/master.pem\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-0kw3lx1",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-0kw3lx1",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-kfylv6f",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-kfylv6f",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-7cjth6k",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-7cjth6k",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master 端认证的公钥存储在："
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-1yn5bm3",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-1yn5bm3",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/etc/salt/pki/master/minions/\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-1pw71vg",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-1pw71vg",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-w1ib965",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-w1ib965",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-176gvvk",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-176gvvk",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "minion 秘钥对默认存储在"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-etbnr1l",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-etbnr1l",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/etc/salt/pki/minion/minion.pub \n/etc/salt/pki/minion/minion.pem\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-0qxv0hz",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-0qxv0hz",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-8e3cvu7",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-8e3cvu7",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-9e81du5",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-9e81du5",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "minion 存放的master公钥"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-yocx2c5",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-yocx2c5",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/etc/salt/pki/minion/minion_master.pub\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-xl63svu",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-xl63svu",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-ya6p5f9",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-ya6p5f9",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-gxe6rlg",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-gxe6rlg",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "minion_id 默认存储在"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-6t0ljhe",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-6t0ljhe",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/etc/salt/minion_id\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-4fs1rg7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-4fs1rg7",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在实际使用过程中，minion端可能会遇到各种原因导致的密钥对儿不匹配的情况，造成在master端显示在denied keys列表中无法通过认证。"
				}
			]
		},
		{
			"ID": "20230601143126-0f9eake",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230601143126-0f9eake",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"ID": "20230601143126-sztuok2",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-sztuok2",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-gatq16j",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-gatq16j",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[master]先在master端删除该id"
								}
							]
						}
					]
				},
				{
					"ID": "20230601143126-5k5x37f",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-5k5x37f",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-iwsprn5",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-iwsprn5",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[minion]再删除minion端的key文件"
								}
							]
						}
					]
				},
				{
					"ID": "20230601143126-56gozk5",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230601143126-56gozk5",
						"updated": "20230601143126"
					},
					"Children": [
						{
							"ID": "20230601143126-9sher3d",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230601143126-9sher3d",
								"updated": "20230601143126"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[minion]最后重启服务"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230601143126-2amyh5w",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230601143126-2amyh5w",
				"updated": "20230601143427"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "rm -fr /etc/salt/pki/minion/minion_master.pub\n#通过上面的介绍可以得知，以上这个文件是在master端认证通过之后，发放到minion端的公钥\n#造成出现这个文件情况是因为早期连接了一个其他的master，更换master导致原公钥无法匹配\n#删除与旧master认证的公钥文件\nrm -fr /etc/salt/pki/minion/minion.pem    #删除minion的私钥文件\nrm -fr /etc/salt/pki/minion/minion.pub    #删除minion的公钥文件\nservice salt-minion restart    #重启服务 会自动重新生成新的密钥对儿\n#此时master端查看keys时，新的主机已经出现在Unaccepted Keys的列表中了\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230601143126-lpuqkav",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-lpuqkav",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "SALTSTACK 安装完成后默认使用hostname 作为ID，需要修改ID："
				}
			]
		},
		{
			"ID": "20230601143126-6gklb3u",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-6gklb3u",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1.停止minion服务"
				}
			]
		},
		{
			"ID": "20230601143126-n93ervs",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-n93ervs",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.删除salt-minion 公钥文件  /etc/salt/pki/minion.pub      /etc/salt/pki/minion.pem"
				}
			]
		},
		{
			"ID": "20230601143126-fdpclvg",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-fdpclvg",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.修改新的minion_id"
				}
			]
		},
		{
			"ID": "20230601143126-vub60a9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-vub60a9",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4.MASTER上删除旧的KEY"
				}
			]
		},
		{
			"ID": "20230601143126-t6lgvn1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-t6lgvn1",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "5.MINION端重新启动　　"
				}
			]
		},
		{
			"ID": "20230601143126-91j3eh2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-91j3eh2",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "6.MASTER端重新接受新的key"
				}
			]
		},
		{
			"ID": "20230601143126-ztiktu9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-ztiktu9",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "修改完成。"
				}
			]
		},
		{
			"ID": "20230601143126-2v9xqbf",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143126-2v9xqbf",
				"updated": "20230601143126"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "因无法截图至外网区域，故只留文字记录修改过程。"
				}
			]
		},
		{
			"ID": "20230601143430-hjngcj9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230601143430-hjngcj9"
			}
		}
	]
}