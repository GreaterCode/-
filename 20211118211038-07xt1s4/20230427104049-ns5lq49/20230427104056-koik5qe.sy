{
	"ID": "20230427104056-koik5qe",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230427104056-koik5qe",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20230427104120-1fgi14v\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230427104340-15d252o\u0026quot;,\u0026quot;scrollTop\u0026quot;:229,\u0026quot;focusId\u0026quot;:\u0026quot;20230427104348-c43onlr\u0026quot;,\u0026quot;focusStart\u0026quot;:169,\u0026quot;focusEnd\u0026quot;:169}",
		"title": "通过模板批量创建虚机",
		"updated": "20230427104538"
	},
	"Children": [
		{
			"ID": "20230427104120-1fgi14v",
			"Type": "NodeList",
			"ListData": {
				"Typ": 1
			},
			"Properties": {
				"id": "20230427104120-1fgi14v",
				"updated": "20230427104120"
			},
			"Children": [
				{
					"ID": "20230427104120-t5f2hd9",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "MS4=",
						"Num": 1
					},
					"Properties": {
						"id": "20230427104120-t5f2hd9",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-yusade0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-yusade0",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "首先创建一个VMware ECS配置的虚机，定义好CPU、内存、磁盘、网络，并且开启嵌套虚拟化；"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-qzl5t9n",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Mi4=",
						"Num": 2
					},
					"Properties": {
						"id": "20230427104120-qzl5t9n",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-ydqigs0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-ydqigs0",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "通过已有集群的PXE将虚机安装成ECS node；"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-myhts4h",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "My4=",
						"Num": 3
					},
					"Properties": {
						"id": "20230427104120-myhts4h",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-o0hu3mn",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-o0hu3mn",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "检查网络等参数是否正确，调整无误后通过vCenter制作成虚拟机模板"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-c8aecfx",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NC4=",
						"Num": 4
					},
					"Properties": {
						"id": "20230427104120-c8aecfx",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-uwax3w6",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-uwax3w6",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "规划DeployVM的文件，定义相关参数"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-koxlhn0",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NS4=",
						"Num": 5
					},
					"Properties": {
						"id": "20230427104120-koxlhn0",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-znktwaw",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-znktwaw",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "使用powershell脚本批量创建虚机"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-umnbcsy",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Ni4=",
						"Num": 6
					},
					"Properties": {
						"id": "20230427104120-umnbcsy",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-pq3j0vt",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-pq3j0vt",
								"updated": "20230427104120"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "使用sn.txt文件结合DeployVM做成主机信息，导入天坪"
								}
							]
						}
					]
				},
				{
					"ID": "20230427104120-80w8rxg",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Ny4=",
						"Num": 7
					},
					"Properties": {
						"id": "20230427104120-80w8rxg",
						"updated": "20230427104120"
					},
					"Children": [
						{
							"ID": "20230427104120-7emhba5",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230427104120-7emhba5",
								"updated": "20230427104244"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "启动集群部署或者扩"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230427104347-q2wzqdx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230427104347-q2wzqdx"
			}
		},
		{
			"ID": "20230427104348-c43onlr",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20230427104348-c43onlr",
				"updated": "20230427104538"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# 创建两网分离\n#Author：\n#version：v0.1\n \n$vms = Import-CSV .\\DeployVM.csv\n$templatemgmtnic = 'bond0'\n$templatesvcnic = 'bondsvc'\n$templateuser = 'root'\n$templatepass = '123456'\n \nConnect-VIServer -Protocol https -User 'vcenterusername' -Password 'vcenterpassword' -Server vcenterip\n \nforeach ($vm in $vms){\n \n      #新建虚拟机\n      New-VM -Name $vm.Name -Template $vm.Template -VMHost $vm.PhysicalHost -Datastore $vm.Datastore -RunAsync -Location $vm.Esxidir\n \n      Start-Sleep -s 90\n      Get-VM $vm.Name | Start-VM\n      Start-Sleep -s 60\n \n      #修改并重启网卡\n      $script1='hostnamectl set-hostname '+$vm.Hostname+' \u0026\u0026 sed -i \"/^IPADDR/c\\IPADDR='+$vm.MgmtIP+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatemgmtnic+' \u0026\u0026 sed -i \"/^NETMASK/c\\NETMASK='+$vm.MgmtNetmask+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatemgmtnic+' \u0026\u0026 sed -i \"/^GATEWAY/c\\GATEWAY='+$vm.MgmtGW+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatemgmtnic+' \u0026\u0026 sed -i \"/^DNS1/c\\DNS1='+$vm.Dns+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatemgmtnic+' \u0026\u0026 sed -i \"/^IPADDR/c\\IPADDR='+$vm.SvcIP+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatesvcnic+' \u0026\u0026 sed -i \"/^NETMASK/c\\NETMASK='+$vm.SvcNetmask+'\" /etc/sysconfig/network-scripts/ifcfg-'+$templatesvcnic+' \u0026\u0026 nmcli c reload \u0026\u0026 nmcli c up '+$templatemgmtnic+' \u0026\u0026 nmcli c up '+$templatesvcnic+''\n \n            #修改hosts及cecloud-nodeagent域名\n            $script2='sed -i \"s/10.253.14.98/'+$vm.Dns+'/g\" /etc/hosts \u0026\u0026 sed -i \"s/xx.3net.intranet.xx.com/'+$vm.tpdomain+'/g\" /root/bin/xx-nodeagent.sh'\n \n            #配置业务网段路由\n            $script3='nmcli connection modify '+$templatesvcnic+' +ipv4.routes \"'+$vm.SvcNet+' '+$vm.SvcGW+'\" \u0026\u0026 nmcli c reload \u0026\u0026 nmcli c up '+$templatesvcnic+''\n \n      #获取VM sn\n            $script4='ifconfig bond0| grep inet | awk ''{print $2}'' \u0026\u0026 dmidecode | grep VMware- | awk -F : ''{gsub (\" \", \"\", $0);print $2}'''\n \n      Get-VM $vm.Name | Invoke-VMScript -ScriptText $script1  -GuestUser $templateuser -GuestPassword  $templatepass\n      Get-VM $vm.Name | Invoke-VMScript -ScriptText $script2  -GuestUser $templateuser -GuestPassword  $templatepass\n      Get-VM $vm.Name | Invoke-VMScript -ScriptText $script3  -GuestUser $templateuser -GuestPassword  $templatepass\n      Get-VM $vm.Name | Invoke-VMScript -ScriptText $script4  -GuestUser $templateuser -GuestPassword  $templatepass \u003e\u003e sn.txt\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20230427104241-pk4br88",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230427104241-pk4br88",
				"updated": "20230427104242"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "参考文档：\n"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://blog.csdn.net/weixin_40720226/article/details/106138325",
					"TextMarkTextContent": "https://blog.csdn.net/weixin_40720226/article/details/106138325"
				},
				{
					"Type": "NodeText",
					"Data": "\n"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://www.cnblogs.com/dreamer-fish/p/15772292.html",
					"TextMarkTextContent": "https://www.cnblogs.com/dreamer-fish/p/15772292.html"
				}
			]
		},
		{
			"ID": "20230427104340-15d252o",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230427104340-15d252o"
			}
		}
	]
}