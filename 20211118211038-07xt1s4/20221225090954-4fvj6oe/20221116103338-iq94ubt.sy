{
	"ID": "20221116103338-iq94ubt",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20221116103338-iq94ubt",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20221116103338-7t1qyuo\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20221116103338-ihfbls8\u0026quot;,\u0026quot;scrollTop\u0026quot;:500,\u0026quot;focusId\u0026quot;:\u0026quot;20221116103338-7t1qyuo\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0}",
		"title": "使用 ezctl 工具部署和管理 Kubernetes 集群",
		"updated": "20221116103338"
	},
	"Children": [
		{
			"ID": "20221116103338-7t1qyuo",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20221116103338-7t1qyuo"
			}
		},
		{
			"ID": "20221116103338-4bmh8ut",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-4bmh8ut"
			},
			"Children": [
				{
					"ID": "20221116103338-8uut7fk",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-8uut7fk"
					},
					"Children": [
						{
							"ID": "20221116103338-4tte5g6",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-4tte5g6"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://mp.weixin.qq.com/s?spm=a2c6h.12873639.article-detail.6.3ba85f6bLRPFp3\u0026__biz=MzkxOTIwMDgxMg==\u0026mid=2247485488\u0026idx=1\u0026sn=3b563e78248d280947493bc6144d2607\u0026scene=21#wechat_redirect",
									"TextMarkTextContent": "https://mp.weixin.qq.com/s?spm=a2c6h.12873639.article-detail.6.3ba85f6bLRPFp3\u0026amp;__biz=MzkxOTIwMDgxMg==\u0026amp;mid=2247485488\u0026amp;idx=1\u0026amp;sn=3b563e78248d280947493bc6144d2607\u0026amp;scene=21#wechat_redirect - 微信公众平台"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-9iycgvn",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-9iycgvn"
					},
					"Children": [
						{
							"ID": "20221116103338-pjaya4j",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-pjaya4j"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "使用 ezctl 工具部署和管理 Kubernetes 集群"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-tcc214g",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-tcc214g"
					},
					"Children": [
						{
							"ID": "20221116103338-z5c8tjl",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-z5c8tjl"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "2022-11-16 10:33:38"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-w6ntu6v",
			"Type": "NodeThematicBreak",
			"Properties": {
				"id": "20221116103338-w6ntu6v"
			}
		},
		{
			"ID": "20221116103338-rhchzme",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221116103338-rhchzme"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1 ezctl 命令行介绍"
				}
			]
		},
		{
			"ID": "20221116103338-eg2v93a",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-eg2v93a"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "kubeasz 项目致力于快速部署高可用的 Kubernetes 集群，同时也提供了关于 Kubernetes 详细的学习资料，在这里强烈推荐给初学者。kubeasz 项目地址：https://github.com/easzlab/kubeasz 。"
				}
			]
		},
		{
			"ID": "20221116103338-237a8ib",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-237a8ib"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "kubeasz 项目使用 ezctl 方便地创建和管理多个 Kubernetes 集群，ezctl 使用 shell 脚本封装 ansible-playbook 执行命令，它十分轻量、简单和易于扩展。查看 ezctl 工具的命令行提示信息，如下所示："
				}
			]
		},
		{
			"ID": "20221116103338-z8hnazb",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-z8hnazb"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "Usage: ezctl COMMAND [args]\n-------------------------------------------------------------------------------------\nCluster setups:\n    list                       to list all of the managed clusters\n    checkout    \u003ccluster\u003e            to switch default kubeconfig of the cluster\n    new         \u003ccluster\u003e            to start a new k8s deploy with name 'cluster'\n    setup       \u003ccluster\u003e  \u003cstep\u003e    to setup a cluster, also supporting a step-by-step way\n    start       \u003ccluster\u003e            to start all of the k8s services stopped by 'ezctl stop'\n    stop        \u003ccluster\u003e            to stop all of the k8s services temporarily\n    upgrade     \u003ccluster\u003e            to upgrade the k8s cluster\n    destroy     \u003ccluster\u003e            to destroy the k8s cluster\n    backup      \u003ccluster\u003e            to backup the cluster state (etcd snapshot)\n    restore     \u003ccluster\u003e            to restore the cluster state from backups\n    start-aio                   to quickly setup an all-in-one cluster with 'default' settingsCluster ops:\n    add-etcd    \u003ccluster\u003e  \u003cip\u003e      to add a etcd-node to the etcd cluster\n    add-master  \u003ccluster\u003e  \u003cip\u003e      to add a master node to the k8s cluster\n    add-node    \u003ccluster\u003e  \u003cip\u003e      to add a work node to the k8s cluster\n    del-etcd    \u003ccluster\u003e  \u003cip\u003e      to delete a etcd-node from the etcd cluster\n    del-master  \u003ccluster\u003e  \u003cip\u003e      to delete a master node from the k8s cluster\n    del-node    \u003ccluster\u003e  \u003cip\u003e      to delete a work node from the k8s clusterExtra operation:\n    kcfg-adm    \u003ccluster\u003e  \u003cargs\u003e    to manage client kubeconfig of the k8s clusterUse \"ezctl help \u003ccommand\u003e\" for more information about a given command.-   命令集 1：集群安装相关操作\n    -   显示当前所有管理的集群\n    -   切换默认集群\n    -   创建新集群配置\n    -   安装新集群\n    -   启动临时停止的集群\n    -   临时停止某个集群（包括集群内运行的 pod）\n    -   升级集群 k8s 组件版本\n    -   删除集群\n    -   备份集群（仅 etcd 数据，不包括 pv 数据和业务应用数据）\n    -   从备份中恢复集群\n    -   创建单机集群（类似 minikube）\n-   命令集 2：集群节点操作\n    -   增加 etcd 节点\n    -   增加主节点\n    -   增加工作节点\n    -   删除 etcd 节点\n    -   删除主节点\n    -   删除工作节点\n-   命令集3：额外操作\n    -   管理客户端 kubeconfig\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-s98tv52",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221116103338-s98tv52"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2 单机 All in One 快速部署 Kubernetes 环境"
				}
			]
		},
		{
			"ID": "20221116103338-n2a3lbm",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-n2a3lbm"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "首先介绍一下如何在单机环境上快速部署一个单节点的 Kubernetes 集群，在国内环境下比官方的 minikube 方便、简单很多。"
				}
			]
		},
		{
			"ID": "20221116103338-vnfmljm",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-vnfmljm"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.1 基础系统配置"
				}
			]
		},
		{
			"ID": "20221116103338-8j2tune",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-8j2tune"
			},
			"Children": [
				{
					"ID": "20221116103338-rh87hzo",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-rh87hzo"
					},
					"Children": [
						{
							"ID": "20221116103338-i3w6cy3",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-i3w6cy3"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "准备一台虚机配置内存 2G，硬盘 30G 以上。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-yp1u2ak",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-yp1u2ak"
					},
					"Children": [
						{
							"ID": "20221116103338-gzkvczk",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-gzkvczk"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "最小化安装"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "Ubuntu 16.04 server"
								},
								{
									"Type": "NodeText",
									"Data": "或者"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "CentOS 7 Minimal"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-wkaoamr",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-wkaoamr"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "注意:"
				},
				{
					"Type": "NodeText",
					"Data": " 确保在干净的系统上开始安装，不要使用曾经装过 kubeadm 或其他 Kubernetes 发行版的环境。"
				}
			]
		},
		{
			"ID": "20221116103338-9fvbt2d",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-9fvbt2d"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.2 下载文件"
				}
			]
		},
		{
			"ID": "20221116103338-hzvz08h",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-hzvz08h"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "下载工具脚本 ezdown，例如使用最新的 kubeasz 版本 3.1.1。"
				}
			]
		},
		{
			"ID": "20221116103338-zy5carh",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-zy5carh"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "export release=3.1.1\nwget https://github.com/easzlab/kubeasz/releases/download/${release}/ezdown\nchmod +x ./ezdown\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-m2pfh4r",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-m2pfh4r"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "下载安装部署 Kubernetes 需要的依赖和镜像。"
				}
			]
		},
		{
			"ID": "20221116103338-abkn7m2",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-abkn7m2"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "./ezdown -D\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-1ufklkr",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-1ufklkr"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "下载系统包（可选，当无法使用 yum/apt 在线安装系统包时可以使用）"
				}
			]
		},
		{
			"ID": "20221116103338-v08vpnh",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-v08vpnh"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "./ezdown -P\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-9qdwaaq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-9qdwaaq"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "上述脚本运行成功后，所有文件（kubeasz 代码、二进制、离线镜像）均已整理好放入目录 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "/etc/kubeasz"
				},
				{
					"Type": "NodeText",
					"Data": "。"
				}
			]
		},
		{
			"ID": "20221116103338-5703mh0",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-5703mh0"
			},
			"Children": [
				{
					"ID": "20221116103338-p2j7e2e",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-p2j7e2e"
					},
					"Children": [
						{
							"ID": "20221116103338-snb9sk4",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-snb9sk4"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/kubeasz"
								},
								{
									"Type": "NodeText",
									"Data": " 包含 kubeasz 版本为 ${release} 的发布代码。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-mb1b478",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-mb1b478"
					},
					"Children": [
						{
							"ID": "20221116103338-b9dopqp",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-b9dopqp"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/kubeasz/bin"
								},
								{
									"Type": "NodeText",
									"Data": " 包含 kubernetes/etcd/docker/cni 等二进制文件。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-wpiuhbj",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-wpiuhbj"
					},
					"Children": [
						{
							"ID": "20221116103338-991h8u5",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-991h8u5"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/kubeasz/down"
								},
								{
									"Type": "NodeText",
									"Data": " 包含集群安装时需要的离线容器镜像。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-l7soq55",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-l7soq55"
					},
					"Children": [
						{
							"ID": "20221116103338-ksbvss0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-ksbvss0"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "/etc/kubeasz/down/packages"
								},
								{
									"Type": "NodeText",
									"Data": " 包含集群安装时需要的系统基础软件。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-il783wc",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-il783wc"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.3 安装集群"
				}
			]
		},
		{
			"ID": "20221116103338-jsfh8p3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-jsfh8p3"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "运行 kubeasz 容器，在 kubeasz 容器中封装了 ezctl 和 ansible。"
				}
			]
		},
		{
			"ID": "20221116103338-j9mqyvs",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-j9mqyvs"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "./ezdown -S\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-z3oam3b",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-z3oam3b"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用默认配置安装 aio(All in One) 集群。"
				}
			]
		},
		{
			"ID": "20221116103338-a3cuugv",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-a3cuugv"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "docker exec -it kubeasz ezctl start-aio\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-zxphk72",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-zxphk72"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "接下来 kubeasz 会使用 ansible playbook 来部署 Kubernetes，运行完毕后如下图所示。"
				}
			]
		},
		{
			"ID": "20221116103338-hdux47d",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-hdux47d"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "图片"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/640-20221116103338-bhs2j5m"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-1qdisvu",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-1qdisvu"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.4 验证安装"
				}
			]
		},
		{
			"ID": "20221116103338-4xyqa5u",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-4xyqa5u"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "如果提示 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "kubectl: command not found"
				},
				{
					"Type": "NodeText",
					"Data": "，退出重新 ssh 登录一下，让环境变量生效即可。"
				}
			]
		},
		{
			"ID": "20221116103338-3ruerjg",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-3ruerjg"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ kubectl version         # 验证集群版本 \n$ kubectl get node        # 验证节点就绪 (Ready) 状态\n$ kubectl get pod -A      # 验证集群 pod 状态，默认已安装网络插件、coredns、metrics-server 等\n$ kubectl get svc -A      # 验证集群服务状态\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-wkgfbb5",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-wkgfbb5"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.5 登录 Dashboard"
				}
			]
		},
		{
			"ID": "20221116103338-6i29gs5",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-6i29gs5"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "默认情况下，Kubernetes Dashboard 已经使用 NodePort 类型的 Service 发布服务了。"
				}
			]
		},
		{
			"ID": "20221116103338-dheglwd",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-dheglwd"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ kubectl get svc -n kube-system|grep dashboard\ndashboard-metrics-scraper   ClusterIP   10.68.53.35     \u003cnone\u003e        8000/TCP                 10m\nkubernetes-dashboard        NodePort    10.68.181.208   \u003cnone\u003e        443:31538/TCP            10m\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-w3ym9wo",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-w3ym9wo"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在 Kubernetes 集群外部通过 https://\u003c节点 IP\u003e:\u003cNodePort 端口\u003e 访问 Dashboard。我们选择使用 Token 方式登录 Dashboard，使用以下命令获取 Token。"
				}
			]
		},
		{
			"ID": "20221116103338-wsv51c1",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-wsv51c1"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# 获取 Bearer Token，找到输出中 ‘token:’ 开头的后面部分\n$ kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')\nName:         admin-user-token-4mj2j\nNamespace:    kube-system\nLabels:       \u003cnone\u003e\nAnnotations:  kubernetes.io/service-account.name: admin-user\n              kubernetes.io/service-account.uid: 86a705ae-50be-4523-8ccb-ceaa0e2bc224Type:  kubernetes.io/service-account-tokenData\n====\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6InlMTng0WTE5NUh3UTg0ZVZ5U1pqTjN6RWZjOHZjT25DRXZmRmdBWjNPQ0UifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTRtajJqIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI4NmE3MDVhZS01MGJlLTQ1MjMtOGNjYi1jZWFhMGUyYmMyMjQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.QHOOBISVRqvdKCbt53-tK2wa9FF3vxvWI4bZLlThhNScqP77q6g3wINVa7f4FGomi7uyuvnU4Hsgdzvey9k_FFg5qtpfR4Rzk8i9GcN7N9-FJFZ9w5yXjbftd0hSQynnySQDD_T2hDdID07LJX_fIbSlNhiRtf-FJVD0LyNxVPgdF9XQ8D_Liqs2IQMhWYD6fVb5QNlm98wzFP8B6RD_X7iMW_CFjyKyxOG7-20cm733ilcumQA8qXty1iTcO4WHasJzFLH7Ovd7Ds-9vcgYiJESPvn9oQV8cilJ5DDhTd9tkPxvYP0aYXDpH3ipjOrPONbBjzjbJ7wFItVOjWAr4A\nca.crt:     1350 bytes\nnamespace:  11 bytes\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-f480h2x",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-f480h2x"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "粘贴 Token，点击登录。"
				}
			]
		},
		{
			"ID": "20221116103338-8j2gcv4",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-8j2gcv4"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "图片"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/640-20221116103338-1f6ob40"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-rjximds",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-rjximds"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "登录成功后的页面如下图所示。"
				}
			]
		},
		{
			"ID": "20221116103338-ihfbls8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-ihfbls8"
			},
			"Children": [
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "图片"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/640-20221116103338-k76yway"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-k0o5cjh",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-k0o5cjh"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2.6 清理现场"
				}
			]
		},
		{
			"ID": "20221116103338-a8dtaw0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-a8dtaw0"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在宿主机上，按照如下步骤清理"
				}
			]
		},
		{
			"ID": "20221116103338-7z0s1zq",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-7z0s1zq"
			},
			"Children": [
				{
					"ID": "20221116103338-00xgo1o",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-00xgo1o"
					},
					"Children": [
						{
							"ID": "20221116103338-vogpeqp",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-vogpeqp"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "清理集群 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "docker exec -it kubeasz ezctl destroy default"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-bdmujtm",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-bdmujtm"
					},
					"Children": [
						{
							"ID": "20221116103338-kaoyr96",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-kaoyr96"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "清理运行的容器 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "./ezdown -C"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-g9mimi3",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-g9mimi3"
					},
					"Children": [
						{
							"ID": "20221116103338-cful0jw",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-cful0jw"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "清理容器镜像 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "docker system prune -a"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-42g7n13",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-42g7n13"
					},
					"Children": [
						{
							"ID": "20221116103338-asdtu2p",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-asdtu2p"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "停止 docker 服务 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "systemctl stop docker"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-ixee0pr",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-ixee0pr"
					},
					"Children": [
						{
							"ID": "20221116103338-dh1b64c",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-dh1b64c"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "使用以下命令删除 docker 文件。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-qz4jdmc",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-qz4jdmc"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": " umount /var/run/docker/netns/default\n umount /var/lib/docker/overlay\n rm -rf /var/lib/docker /var/run/docker\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-mof4u8t",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-mof4u8t"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "上述清理脚本执行成功后，建议重启节点，以确保清理残留的虚拟网卡、路由等信息。"
				}
			]
		},
		{
			"ID": "20221116103338-h0af3jf",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221116103338-h0af3jf"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3 部署多套 Kubernetes 集群"
				}
			]
		},
		{
			"ID": "20221116103338-q5pp6qi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-q5pp6qi"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用一台单独的机器作为 ezctl 的部署节点，ezctl 节点需要能够免密登录部署 Kubernetes 的机器，并且在 ezctl 节点上安装好 ansible（或者直接使用 kubeasz 容器）。"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "图片"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/640-20221116103338-vd56c2l"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-j3g9wgo",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-j3g9wgo"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.1 机器规划"
				}
			]
		},
		{
			"ID": "20221116103338-q7bt0j2",
			"Type": "NodeTable",
			"TableAligns": [
				0,
				0,
				0,
				0
			],
			"Properties": {
				"id": "20221116103338-q7bt0j2"
			},
			"Children": [
				{
					"Type": "NodeTableHead",
					"Data": "thead",
					"Children": [
						{
							"Type": "NodeTableRow",
							"Data": "tr",
							"Children": [
								{
									"Type": "NodeTableCell",
									"Data": "th",
									"Children": [
										{
											"Type": "NodeText",
											"Data": "主机名"
										}
									]
								},
								{
									"Type": "NodeTableCell",
									"Data": "th",
									"Children": [
										{
											"Type": "NodeText",
											"Data": "IP 地址"
										}
									]
								},
								{
									"Type": "NodeTableCell",
									"Data": "th",
									"Children": [
										{
											"Type": "NodeText",
											"Data": "角色"
										}
									]
								},
								{
									"Type": "NodeTableCell",
									"Data": "th",
									"Children": [
										{
											"Type": "NodeText",
											"Data": "集群"
										}
									]
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster01-1"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.159"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 1"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster01-2"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.161"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "worker"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 1"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster01-3"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.160"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "worker"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 1"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster02-1"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.162"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "master"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 2"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster02-2"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.163"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "worker"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 2"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "cluster02-3"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.38.148"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "worker"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "集群 2"
								}
							]
						}
					]
				},
				{
					"Type": "NodeTableRow",
					"Data": "tr",
					"Children": [
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "ansible01"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "11.8.36.21"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeText",
									"Data": "ezctl 节点"
								}
							]
						},
						{
							"Type": "NodeTableCell",
							"Data": "td",
							"Children": [
								{
									"Type": "NodeBr",
									"Data": "br"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-rviwgpr",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-rviwgpr"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.2 配置免密登录"
				}
			]
		},
		{
			"ID": "20221116103338-q7x8cg9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-q7x8cg9"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在 ansible01 机器上配置对 Kubernetes 节点的免密登录。"
				}
			]
		},
		{
			"ID": "20221116103338-x5ybl3m",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-x5ybl3m"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# 生产公私钥对\nssh-keygen# 拷贝公钥到其他机器\nssh-copy-id root@11.8.36.159\nssh-copy-id root@11.8.36.161\nssh-copy-id root@11.8.36.160\nssh-copy-id root@11.8.36.162\nssh-copy-id root@11.8.36.163\nssh-copy-id root@11.8.38.148\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-uh5yw8w",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-uh5yw8w"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.3 创建配置文件"
				}
			]
		},
		{
			"ID": "20221116103338-nn97my0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-nn97my0"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用以下命令生成 Kubernetes 集群的配置文件，在 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "/etc/kubeasz/clusters/\u0026lt;集群名\u0026gt;"
				},
				{
					"Type": "NodeText",
					"Data": " 目录下会生产 hosts 和 config.yml 两个配置文件。"
				}
			]
		},
		{
			"ID": "20221116103338-ct4cio9",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-ct4cio9"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# cluster01 是自己取的集群名\n./ezctl new cluster01\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-8jrgoou",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-8jrgoou"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "修改 hosts 配置文件，设置相关节点角色的 IP 地址，其他配置可以保持默认。config.yml 配置文件可以保持默认。"
				}
			]
		},
		{
			"ID": "20221116103338-aa9fnby",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-aa9fnby"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# cluster01 主机信息\n# 'etcd' cluster should have odd member(s) (1,3,5,...)\n[etcd]\n11.8.36.159\n11.8.36.161\n11.8.36.160# master node(s)\n[kube_master]\n11.8.36.159# work node(s)\n[kube_node]\n11.8.36.161\n11.8.36.160# 设置网络插件为 calico (可选)，默认是 flannel \nCLUSTER_NETWORK= \"calico\"\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-s9arn6q",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-s9arn6q"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.4 安装集群"
				}
			]
		},
		{
			"ID": "20221116103338-hy55hth",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-hy55hth"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用以下命令安装 Kubernetes 集群。"
				}
			]
		},
		{
			"ID": "20221116103338-xar1pyy",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-xar1pyy"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# 一键安装\n./ezctl setup cluster01 all# 或者分步安装，具体使用 ezctl help setup 查看分步安装帮助信息\n./ezctl setup cluster01 01\n./ezctl setup cluster01 02\n./ezctl setup cluster01 03\n./ezctl setup cluster01 04\n...\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-cxz1cti",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-cxz1cti"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "重复步骤 3.3 创建配置文件和 3.4 安装集群创建 cluster02 集群。"
				}
			]
		},
		{
			"ID": "20221116103338-almmyi6",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-almmyi6"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3.5 查看集群状态"
				}
			]
		},
		{
			"ID": "20221116103338-8o791ki",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-8o791ki"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "# cluster01 状态\nroot@cluster01-1:/root #kubectl get node\nNAME          STATUS                     ROLES    AGE   VERSION\n11.8.36.159   Ready,SchedulingDisabled   master   91m   v1.22.2\n11.8.36.160   Ready                      node     90m   v1.22.2\n11.8.36.161   Ready                      node     90m   v1.22.2# cluster02 状态\nroot@cluster02-1:/root #kubectl get node\nNAME          STATUS                     ROLES    AGE     VERSION\n11.8.36.162   Ready,SchedulingDisabled   master   5m43s   v1.22.2\n11.8.36.163   Ready                      node     4m56s   v1.22.2\n11.8.38.148   Ready                      node     4m56s   v1.22.2\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-9h5l7hl",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221116103338-9h5l7hl"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4 备份和恢复 Etcd"
				}
			]
		},
		{
			"ID": "20221116103338-xdtz2mw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-xdtz2mw"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Kubernetes 使用 Etcd 数据库来存储集群中的数据，Etcd 备份的是某一时刻 Kubernetes 集群中的完整状态。接下来将分别介绍 Etcd 的备份与恢复："
				}
			]
		},
		{
			"ID": "20221116103338-e2mrx69",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-e2mrx69"
			},
			"Children": [
				{
					"ID": "20221116103338-m1ogtv5",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-m1ogtv5"
					},
					"Children": [
						{
							"ID": "20221116103338-gwgrtgu",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-gwgrtgu"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "从运行的 Etcd 集群备份数据到磁盘文件。"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-dasrflv",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-dasrflv"
					},
					"Children": [
						{
							"ID": "20221116103338-kaqglaz",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-kaqglaz"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "从 Etcd 备份文件恢复数据，从而使集群恢复到备份时状态。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20221116103338-qd0r46j",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-qd0r46j"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "首先在已经搭建好的 Kubernetes 集群中部署两个测试 deployment。"
				}
			]
		},
		{
			"ID": "20221116103338-712uuuo",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-712uuuo"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "kubectl create deployment nginx-a --image=nginx\nkubectl create deployment nginx-b --image=nginx\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-j4n2q18",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-j4n2q18"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "查看 deployment 和 pod 运行状态。"
				}
			]
		},
		{
			"ID": "20221116103338-cd7plf5",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-cd7plf5"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ kubectl get deployments.apps \nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-a   1/1     1            1           34s\nnginx-b   1/1     1            1           30s$ kubectl get pod \nNAME                       READY   STATUS    RESTARTS   AGE\nnginx-a-76865cf8c8-w4mqf   1/1     Running   0          29s\nnginx-b-6bcf96755c-wwgs4   1/1     Running   0          25s\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-5zs7brs",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-5zs7brs"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4.1 备份数据"
				}
			]
		},
		{
			"ID": "20221116103338-9yjvznq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-9yjvznq"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "接下来使用 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "ezctl backup"
				},
				{
					"Type": "NodeText",
					"Data": " 命令对集群 cluster01 的 Etcd 进行备份，在备份的时候 Kubernetes 集群中的服务不受影响。"
				}
			]
		},
		{
			"ID": "20221116103338-c725cdh",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-c725cdh"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "./ezctl backup cluster01\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-udoz6r9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-udoz6r9"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "执行完毕可以在部署 ezctl 主机的 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "/etc/kubeasz/clusters/\u0026lt;集群名\u0026gt;/backup/"
				},
				{
					"Type": "NodeText",
					"Data": "目录下检查备份情况，其中，snapshot.db 始终为最近一次备份文件，还有一个带有时间戳的文件表示具体的备份版本，因为我们当前只有一次备份，因此这两个备份文件的内容是一样的。"
				}
			]
		},
		{
			"ID": "20221116103338-73gmq4l",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-73gmq4l"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ ls -l /etc/kubeasz/clusters/cluster01/backup/\ntotal 6160\n-rw------- 1 root root 3149856 Dec 14 13:28 snapshot_202112141328.db\n-rw------- 1 root root 3149856 Dec 14 13:29 snapshot.db\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-e3fe6d2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-e3fe6d2"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "现在我们假装误删除 deployment nginx-a。"
				}
			]
		},
		{
			"ID": "20221116103338-yu9bcqu",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-yu9bcqu"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "kubectl delete deployments.apps nginx-a# 查看当前的 deployment，现在只剩下 nginx-b\n$ kubectl get deployments.apps \nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-b   1/1     1            1           10m\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-enzy53i",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20221116103338-enzy53i"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "4.2 恢复数据"
				}
			]
		},
		{
			"ID": "20221116103338-3ttmuay",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-3ttmuay"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "然后使用 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "ezctl restore"
				},
				{
					"Type": "NodeText",
					"Data": " 命令来恢复 Etcd 的备份数据，默认情况下是恢复最近一次的备份文件 snapshot.db，如果需要指定恢复的版本，可以在 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "roles/cluster-restore/defaults/main.yml"
				},
				{
					"Type": "NodeText",
					"Data": " 文件中配置需要恢复的 Etcd 备份版本。"
				}
			]
		},
		{
			"ID": "20221116103338-qxfk79b",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-qxfk79b"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "./ezctl restore cluster01\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-xck9vls",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20221116103338-xck9vls"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在恢复的时候会停止 kube-apiserver，kube-controller-manager, kube-scheduler, kubelet, etcd 等服务，待 Etcd 恢复完毕后，再重启启动服务。查看恢复后的 deployment 和 pod，可以看到现在 nginx-a deployment 已经恢复。"
				}
			]
		},
		{
			"ID": "20221116103338-l81zn1m",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20221116103338-l81zn1m"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "$ kubectl get deployments.apps \nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-a   1/1     1            1           14m\nnginx-b   1/1     1            1           14m$ kubectl get pod \nNAME                       READY   STATUS    RESTARTS   AGE\nnginx-a-76865cf8c8-w4mqf   1/1     Running   0          15m\nnginx-b-6bcf96755c-wwgs4   1/1     Running   0          14m\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20221116103338-i9lwg4t",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20221116103338-i9lwg4t"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "5 参考资料"
				}
			]
		},
		{
			"ID": "20221116103338-vhhzi4r",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20221116103338-vhhzi4r"
			},
			"Children": [
				{
					"ID": "20221116103338-oe488b6",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-oe488b6"
					},
					"Children": [
						{
							"ID": "20221116103338-bmg2h5x",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-bmg2h5x"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[kubeasz github 项目地址] (https://github.com/easzlab/kubeasz)"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-xy0n5t9",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-xy0n5t9"
					},
					"Children": [
						{
							"ID": "20221116103338-c3tiap8",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-c3tiap8"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[Deploy a Production Ready Kubernetes Cluster] (https://github.com/kubernetes-sigs/kubespray)"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-7wokwe5",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-7wokwe5"
					},
					"Children": [
						{
							"ID": "20221116103338-hw0lrrh",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-hw0lrrh"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[Ansible for k8s] (https://cloud.tencent.com/developer/article/1564975)"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-45430i3",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-45430i3"
					},
					"Children": [
						{
							"ID": "20221116103338-6ly0ave",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-6ly0ave"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[K8S 集群备份与恢复] (http://www.xuyasong.com/?p=2052)"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-sxea8w3",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-sxea8w3"
					},
					"Children": [
						{
							"ID": "20221116103338-inyjobs",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-inyjobs"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[Kubernetes Etcd 数据备份与恢复] (http://www.mydlq.club/article/74/)"
								}
							]
						}
					]
				},
				{
					"ID": "20221116103338-s4y4e23",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20221116103338-s4y4e23"
					},
					"Children": [
						{
							"ID": "20221116103338-v6vd4x1",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20221116103338-v6vd4x1"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "[通过备份 Etcd 来完美恢复 Kubernetes 中的误删数据] (https://mp.weixin.qq.com/s/4b2COdr5q4SFfJTy3wl8gA)"
								}
							]
						}
					]
				}
			]
		}
	]
}