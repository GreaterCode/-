{
	"ID": "20230903113705-29l2kow",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230903113705-29l2kow",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20230903113706-8aqbbz1\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230903113806-m2znez1\u0026quot;,\u0026quot;scrollTop\u0026quot;:192,\u0026quot;focusId\u0026quot;:\u0026quot;20230903113754-iourbi3\u0026quot;,\u0026quot;focusStart\u0026quot;:4,\u0026quot;focusEnd\u0026quot;:4}",
		"title": "1.5 长链接场景",
		"updated": "20230903113806"
	},
	"Children": [
		{
			"ID": "20230903113706-8aqbbz1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113706-8aqbbz1",
				"updated": "20230903113740"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "如果业务是长链接场景，比如游戏、会议、直播等，客户端与服务端会保持着长链接:"
				}
			]
		},
		{
			"ID": "20230903113746-kzjqtpn",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113746-kzjqtpn",
				"updated": "20230903113747"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "image"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image-20230903113746-awhjytg.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230903113752-7v15xyw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113752-7v15xyw",
				"updated": "20230903113753"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "销毁 Pod 时需要的优雅终止的时间通常比较长 (preStop + 业务进程停止超过 30s)，有的极端情况甚至可能长达数小时，这时候可以根据实际情况自定义 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "terminationGracePeriodSeconds"
				},
				{
					"Type": "NodeText",
					"Data": "​，避免过早的被 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "SIGKILL"
				},
				{
					"Type": "NodeText",
					"Data": "​ 杀死，示例:"
				}
			]
		},
		{
			"ID": "20230903113754-iourbi3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113754-iourbi3",
				"updated": "20230903113758"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "image"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image-20230903113758-xfuikad.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230903113805-tx2ewp6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113805-tx2ewp6",
				"updated": "20230903113806"
			}
		},
		{
			"ID": "20230903113806-8w0tt10",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113806-8w0tt10",
				"updated": "20230903113806"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "具体设置多大可以根据业务场景最坏的情况来预估，比如对战类游戏场景，同一房间玩家的客户端都连接的同一个服务端 Pod，一轮游戏最长半个小时，那么我们就设置 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "terminationGracePeriodSeconds"
				},
				{
					"Type": "NodeText",
					"Data": "​ 为 1800。"
				}
			]
		},
		{
			"ID": "20230903113806-m2znez1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230903113806-m2znez1",
				"updated": "20230903113806"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "如果不好预估最坏的情况，最好在业务层面优化下，比如 Pod 销毁时的优雅终止逻辑里面主动通知下客户端，让客户端连到新的后端，然后客户端来保证这两个连接的平滑切换。等旧 Pod 上所有客户端连接都连切换到了新 Pod 上，才最终退出"
				}
			]
		}
	]
}