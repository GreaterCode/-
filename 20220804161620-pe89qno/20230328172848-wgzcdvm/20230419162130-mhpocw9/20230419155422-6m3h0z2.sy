{
	"ID": "20230419155422-6m3h0z2",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230419155422-6m3h0z2",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20230419155422-z5ugvau\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230419155422-tu66xh9\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230419155422-njzzhtj\u0026quot;,\u0026quot;focusStart\u0026quot;:11,\u0026quot;focusEnd\u0026quot;:11}",
		"title": "大规模存储集群监控方案 ",
		"updated": "20230419161815"
	},
	"Children": [
		{
			"ID": "20230419155422-z5ugvau",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-z5ugvau",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "背景"
				}
			]
		},
		{
			"ID": "20230419155422-m9qdef9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-m9qdef9",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "存储集群因其特殊性，和常规的监控场景有一些不同，需要考虑以下特殊性和限制："
				}
			]
		},
		{
			"ID": "20230419155422-gkvjq80",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-gkvjq80",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-ue9e97x",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-ue9e97x",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-0bp8qj2",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-0bp8qj2",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "节点数量大，采集任务多，采集压力大；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-gyqn6m7",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-gyqn6m7",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-72726zt",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-72726zt",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "无外部对象存储。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-h5kngtj",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-h5kngtj",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "核心诉求"
				}
			]
		},
		{
			"ID": "20230419155422-g2zsp0x",
			"Type": "NodeList",
			"ListData": {
				"Typ": 1
			},
			"Properties": {
				"id": "20230419155422-g2zsp0x",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-gcpr8jz",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "MS4=",
						"Num": 1
					},
					"Properties": {
						"id": "20230419155422-gcpr8jz",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-g3lkhq8",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-g3lkhq8",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "满足大规模存储集群的组件基础监控和业务层面的监控；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-ni3jyy1",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Mi4=",
						"Num": 2
					},
					"Properties": {
						"id": "20230419155422-ni3jyy1",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-g6skzmk",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-g6skzmk",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警实时推送，并支持自定义告警的发送；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-mhaw8oc",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "My4=",
						"Num": 3
					},
					"Properties": {
						"id": "20230419155422-mhaw8oc",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-w0rzpx3",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-w0rzpx3",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持告警规则设置，包括阈值、级别等；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-co0zyec",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NC4=",
						"Num": 4
					},
					"Properties": {
						"id": "20230419155422-co0zyec",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-0dvp53y",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-0dvp53y",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警实时展示；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-ai924kl",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "NS4=",
						"Num": 5
					},
					"Properties": {
						"id": "20230419155422-ai924kl",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-9eemzxw",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-9eemzxw",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警通道支持SNMP Trap、邮件、短信等；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-emoffgs",
					"Type": "NodeListItem",
					"ListData": {
						"Typ": 1,
						"Delimiter": 46,
						"Marker": "Ni4=",
						"Num": 6
					},
					"Properties": {
						"id": "20230419155422-emoffgs",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-njzzhtj",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-njzzhtj",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警信息持久化到数据库的能力。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-a6v09b9",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-a6v09b9",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "面临的挑战"
				}
			]
		},
		{
			"ID": "20230419155422-42dcx6h",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-42dcx6h",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "监控不稳定"
				}
			]
		},
		{
			"ID": "20230419155422-fzky15b",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-fzky15b",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控组件不稳定"
				},
				{
					"Type": "NodeText",
					"Data": "​：原生Prometheus并不支持高可用，也不能做横向扩缩容，无法避免单机性能瓶颈的问题，过大的监控数据经常会造成Prometheus实例出现OOM，同时由于纳管监控对象的过程中会对Prometheus实例进行变更，频繁的变更会触发Prometheus卡死。"
				}
			]
		},
		{
			"ID": "20230419155422-t8mcyi4",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-t8mcyi4",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控与业务耦合"
				},
				{
					"Type": "NodeText",
					"Data": "​：为避免数据量大造成OOM，需要人工拆分Prometheus实现数据分片，这样不仅增加维护成本，同时由于存在自动纳管的机制，纳管机制与人工分片强耦合，不利于后期运营和功能拓展。"
				}
			]
		},
		{
			"ID": "20230419155422-569ondz",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-569ondz",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "监控链路不稳定"
				},
				{
					"Type": "NodeText",
					"Data": "​：当Prometheus出现OOM重启时，由于本地盘存储数据量大，启动加载慢，重启耗时长，经常造成较长时间的数据断点。"
				}
			]
		},
		{
			"ID": "20230419155422-kq9agck",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-kq9agck",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "无法动态扩缩容"
				},
				{
					"Type": "NodeText",
					"Data": "​：虽然Prometheus可以通过hash_mod的方式进行采集任务的分片，但是该方式需要人工干预，无法动态扩缩容。"
				}
			]
		},
		{
			"ID": "20230419155422-cygk0d3",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-cygk0d3",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "运维成本高"
				}
			]
		},
		{
			"ID": "20230419155422-9d257hf",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-9d257hf",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "监控组件需要自运维：监控数据分片需要人工拆分监控实例，监控组件需要自运维保活，确保监控可用性。"
				}
			]
		},
		{
			"ID": "20230419155422-tlydihy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-tlydihy",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "容量扩展需要人工干预：当单机Prometheus无法满足大量的采集目标处理任务时，会导致OOM重启，此时对于Prometheus的纵向扩展需要人工干预。"
				}
			]
		},
		{
			"ID": "20230419155422-pxpqvrl",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-pxpqvrl",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "理想模型"
				}
			]
		},
		{
			"ID": "20230419155422-75qeig0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-75qeig0",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "为了解决上述几个问题，我们需要先构思一个理想模型。"
				}
			]
		},
		{
			"ID": "20230419155422-aeexx3g",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-aeexx3g",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "采集 - 高性能"
				}
			]
		},
		{
			"ID": "20230419155422-1xfj0rz",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-1xfj0rz",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在采集侧，我们遇到的问题主要就是性能问题，由于单机Prometheus的性能瓶颈，限制了海量数据采集的能力，我们希望采集侧有以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-1mrzfiy",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-1mrzfiy",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-pi0slcr",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-pi0slcr",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-uzmevzv",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-uzmevzv",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "高性能：有无限性能的采集器；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-2zyqtpz",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-2zyqtpz",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-sjstqvw",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-sjstqvw",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "Prometheus原生：支持Prometheus主流的配置方式，包括Prometheus operator所支持的ServiceMonitor和PodMonitor等。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-y54asfb",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-y54asfb",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "存储 - 长期存储"
				}
			]
		},
		{
			"ID": "20230419155422-huxtmbc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-huxtmbc",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在存储侧，理想模型应该包括以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-fvm7y46",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-fvm7y46",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-vw1p7ym",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-vw1p7ym",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-tt4v935",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-tt4v935",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "具备水平可扩展能力，可支持海量数据存储；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-dw8ikc8",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-dw8ikc8",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-sqbq323",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-sqbq323",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "存储资源的利用率高。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-pzrutb3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-pzrutb3",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "查询 - 低延迟"
				}
			]
		},
		{
			"ID": "20230419155422-bobo7yx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-bobo7yx",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在查询侧，作为直接面向用户的查询接口，应该具备以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-ll6nxyx",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-ll6nxyx",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-ngqogy7",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-ngqogy7",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-mhn053s",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-mhn053s",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "高性能：查询侧水平可扩展，分摊查询压力；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-kib2ucw",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-kib2ucw",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-0mm9p6r",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-0mm9p6r",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "低延迟：提升用户查询体验。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-0zkfv1z",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-0zkfv1z",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "展示 - 全局视图"
				}
			]
		},
		{
			"ID": "20230419155422-4yhujlr",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-4yhujlr",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在展示侧，理想化模型应该具备以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-eixr91h",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-eixr91h",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-3glxknm",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-3glxknm",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-45fltuv",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-45fltuv",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持对接Grafana做大屏展示；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-cu1mise",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-cu1mise",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-96vfrw2",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-96vfrw2",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持全局聚合查询。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-2u33ivy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-2u33ivy",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "告警 - 原生及扩展"
				}
			]
		},
		{
			"ID": "20230419155422-oy9bir5",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-oy9bir5",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在告警侧，需要具备以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-shokdpi",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-shokdpi",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-diezdsi",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-diezdsi",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-uxmcixd",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-uxmcixd",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "支持Prometheus原生的告警配置；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-56iswsc",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-56iswsc",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-1smnwrp",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-1smnwrp",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "告警通道可扩展。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-h39d2wi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-h39d2wi",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "运维 - 便捷"
				}
			]
		},
		{
			"ID": "20230419155422-8gyzpq7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-8gyzpq7",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "使用Kubernetes原生方式进行管理，降低运维复杂性。"
				}
			]
		},
		{
			"ID": "20230419155422-tuwslcd",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-tuwslcd",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "解决方案"
				}
			]
		},
		{
			"ID": "20230419155422-wdzzenj",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-wdzzenj",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "采集端 - 实现可分片高可用Prometheus"
				}
			]
		},
		{
			"ID": "20230419155422-qsxiaui",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-qsxiaui",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当采集大量目标时，单机Prometheus的性能瓶颈是我们亟待解决的问题，我们需要修改Prometheus以让其支持横向扩缩容。"
				}
			]
		},
		{
			"ID": "20230419155422-slgjfmm",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-slgjfmm",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "设计原则"
				}
			]
		},
		{
			"ID": "20230419155422-3xa8nxf",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-3xa8nxf",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于采集端Prometheus的修改，我们希望具备以下能力："
				}
			]
		},
		{
			"ID": "20230419155422-ez7a0vd",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230419155422-ez7a0vd",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"ID": "20230419155422-pqen3z8",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-pqen3z8",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-m3hwibs",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-m3hwibs",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "根据采集任务量，实现动态扩缩容；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-ph4apr9",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-ph4apr9",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-x41wfe8",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-x41wfe8",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "多个Prometheus采集器之间实现采集任务的负载均衡；"
								}
							]
						}
					]
				},
				{
					"ID": "20230419155422-u1c1dys",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230419155422-u1c1dys",
						"updated": "20230419155422"
					},
					"Children": [
						{
							"ID": "20230419155422-oi13u4j",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230419155422-oi13u4j",
								"updated": "20230419155422"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "完全兼容原来的配置文件即采集能力。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230419155422-9eapw40",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-9eapw40",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通过调研，社区开源组件"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/tkestack/kvass/blob/master/README_CN.md",
					"TextMarkTextContent": "kvass"
				},
				{
					"Type": "NodeText",
					"Data": "可以满足我们的需求，kvass是一个Prometheus横向扩容解决方案，使用Sidecar动态的根据Coordinator分配下来的target列表来为每个Prometheus生成只含特定target的配置文件，从而将采集任务动态调度到各个Prometheus分片。Coordinator 用于服务发现，target调度和分片扩缩容管理。TSDB用来将分片数据汇总成全局数据。"
				}
			]
		},
		{
			"ID": "20230419155422-lfn0l49",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-lfn0l49",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "简单来说，就是由独立组件（Coordinator）做服务发现，并把target集合及数据规模提前探测出来，直接分配给几个Prometheus去抓取，分片不再进行服务发现，只负责数据抓取。"
				}
			]
		},
		{
			"ID": "20230419155422-1fe2q9n",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-1fe2q9n",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "存储端 - 远程统一存储"
				}
			]
		},
		{
			"ID": "20230419155422-q0sczlv",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-q0sczlv",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "由于在采集端将采集任务分片，所以在存储端，我们需要一个统一的存储来将分片化的Prometheus数据进行存储。业界在这方面有不少优秀的开源项目，我们选取目前比较知名的两个项目，从架构、接入方式、存储、性能、资源需求等方面做比较。"
				}
			]
		},
		{
			"ID": "20230419155422-r3442ro",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20230419155422-r3442ro",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "Thanos vs VictoriaMetrics"
				}
			]
		},
		{
			"ID": "20230419155422-0e2q63b",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-0e2q63b",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "整体比较"
				}
			]
		},
		{
			"ID": "20230419155422-9l70eu3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-9l70eu3",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Thanos是社区十分流行的Prometheus高可用解决方案，其整体架构如图所示："
				}
			]
		},
		{
			"ID": "20230419155422-i23won2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-i23won2",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText",
							"Data": "Receive"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "https://docs.google.com/drawings/d/e/2PACX-1vTfko27YB_3ab7ZL8ODNG5uCcrpqKxhmqaz3lW-yhGN3_oNxkTrqXmwwlcZjaWf3cGgAJIM4CMwwkEV/pub?w=960\u0026h=720"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230419155422-m1npy0e",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-m1npy0e",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从采集侧看，Prometheus将采集的数据远程写到Thanos Receiver组件，采集Prometheus可以有多个，各自上报各自采集到的数据。"
				}
			]
		},
		{
			"ID": "20230419155422-99byfff",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-99byfff",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "查询时，Thanos query组件通过Store API在各数据存储组件中查询数据并做聚合、去重，然后返回给客户端。"
				}
			]
		},
		{
			"ID": "20230419155422-d4c9dic",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-d4c9dic",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "而VictoriaMetrics是一个快速、经济、可扩展的监控解决方案和时间序列数据库。官方宣传其相比较于Thanos等有更加强大的性能，其整体架构如下图所示："
				}
			]
		},
		{
			"ID": "20230419155422-q8qk6td",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-q8qk6td",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "https://docs.google.com/drawings/d/e/2PACX-1vTvk2raU9kFgZ84oF-OKolrGwHaePhHRsZEcfQ1I_EC5AB_XPWwB392XshxPramLJ8E4bqptTnFn5LL/pub?w=1104\u0026h=746"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230419155422-9ywspcq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-9ywspcq",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从架构上来看，Thanos比VictoriaMetrics要复杂一些，且需要依赖于外部对象存储。"
				}
			]
		},
		{
			"ID": "20230419155422-hmhomu3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-hmhomu3",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从接入方式看，Thanos和VictoriaMetrics都可以作为Prometheus的远程存储，只需要在Prometheus的配置文件中指定remote_write地址即可，两者的接入方式没有差别。"
				}
			]
		},
		{
			"ID": "20230419155422-21kmr26",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-21kmr26",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从存储类型看，VictoriaMetrics使用本地文件系统作为存储，而Thanos需要对接外部对象存储，虽然现在Thanos也支持本地文件系统，但是该存储类型是实验性的，只要用于测试和演示，官方不建议将其用作生产环境中指标的主存储。"
				}
			]
		},
		{
			"ID": "20230419155422-pbamluu",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-pbamluu",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从性能表现看，由于使用本地文件系统作为存储，不受网络质量的影响，VictoriaMetrics的查询性能比Thanos更好。"
				}
			]
		},
		{
			"ID": "20230419155422-vzaz8z8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-vzaz8z8",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从资源需求看，VictoriaMetrics使用更优的压缩算法，在处理和存储相同数量的时序序列时，VictoriaMetrics所使用的RAM和存储空间比Thanos少7倍。"
				}
			]
		},
		{
			"ID": "20230419155422-5fvynmy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-5fvynmy",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "选型"
				}
			]
		},
		{
			"ID": "20230419155422-bfzxum7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-bfzxum7",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "从以上分析来看，并且由于存储集群的特殊性（无可用外部对象存储，只能使用本地文件系统），VictoriaMetrics是更合适的选择。"
				}
			]
		},
		{
			"ID": "20230419155422-751jiay",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-751jiay",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "配置管理"
				}
			]
		},
		{
			"ID": "20230419155422-k7clsm3",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-k7clsm3",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于告警规则和告警通道的配置管理，运维中心已经支持这部分功能，可以考虑复用。"
				}
			]
		},
		{
			"ID": "20230419155422-gz1rehl",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-gz1rehl",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "告警通道"
				}
			]
		},
		{
			"ID": "20230419155422-vslijsm",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-vslijsm",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Alertmanager原生支持以下的通知方式："
				}
			]
		},
		{
			"ID": "20230419155422-5cabwwy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-5cabwwy",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image2022-4-2_11-3-38-20230419155422-kim18us.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230419155422-97e0ddq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-97e0ddq",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于不支持的通知方式（如SNMP Trap、短信等），可以考虑使用webhook方式将告警发送到消息通知中心，由消息通知中心转发，这也是目前我们的实现方式，但是现在对接的消息通知中心只支持邮件，如果有更多告警通道的需求，需要考虑自研消息通知中心。"
				}
			]
		},
		{
			"ID": "20230419155422-mfkle3w",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-mfkle3w",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "数据持久化"
				}
			]
		},
		{
			"ID": "20230419155422-d4p41mp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-d4p41mp",
				"updated": "20230419161815"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于历史告警数据，Alertmanager并不具备持久化的能力，我们需要在告警发出时对其做记录，Alertmanager官方推荐"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/yakshaving-art/alertsnitch",
					"TextMarkTextContent": "AlertSnitch"
				},
				{
					"Type": "NodeText",
					"Data": "将历史告警"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkTextContent": "信息"
				},
				{
					"Type": "NodeText",
					"Data": "存储到数据库中。"
				}
			]
		},
		{
			"ID": "20230419155422-lf8nhj4",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-lf8nhj4",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "架构设计"
				}
			]
		},
		{
			"ID": "20230419155422-x7eziit",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-x7eziit",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "架构图"
				}
			]
		},
		{
			"ID": "20230419155422-apeywx9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-apeywx9",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "​"
				},
				{
					"Type": "NodeImage",
					"Data": "span",
					"Children": [
						{
							"Type": "NodeBang"
						},
						{
							"Type": "NodeOpenBracket"
						},
						{
							"Type": "NodeLinkText"
						},
						{
							"Type": "NodeCloseBracket"
						},
						{
							"Type": "NodeOpenParen"
						},
						{
							"Type": "NodeLinkDest",
							"Data": "assets/image2022-4-2_11-4-2-20230419155422-7lmxz07.png"
						},
						{
							"Type": "NodeCloseParen"
						}
					]
				},
				{
					"Type": "NodeText",
					"Data": "​"
				}
			]
		},
		{
			"ID": "20230419155422-9tdiuam",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-9tdiuam",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "整个架构采用分层设计，各层之间没有强依赖，可以进行独立容量扩展。"
				}
			]
		},
		{
			"ID": "20230419155422-alv4yav",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-alv4yav",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "采集层"
				}
			]
		},
		{
			"ID": "20230419155422-hlkhz0r",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-hlkhz0r",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "通过在Prometheus旁边加上Kvass Sidecar来实现Prometheus的横向扩缩容，Kvass Coordinator加载全局配置文件并进行服务发现，获取所有的target，对于每个需要采集的target，Coordinator为其进行relabel_configs，并且探测target当前包含的series数，Coordinator周期性的下推新target，转移target，以及进行分片的扩缩容。Prometheus根据Coordinator下推的配置进行数据采集并且remote write到远程的TSDB做统一存储。"
				}
			]
		},
		{
			"ID": "20230419155422-yjw939w",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-yjw939w",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "存储层"
				}
			]
		},
		{
			"ID": "20230419155422-f7x4m4r",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-f7x4m4r",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "不同的TSDB的具体实现虽然千差万别，但是其核心功能基本都包括存储、查询、告警三部分。TSDB接收Prometheus远程写的数据并将数据持久化存储（外部对象存储、本地文件系统等）；Query查询组件接收用户的查询请求，从TSDB获取数据并做聚合、去重等操作并将结果返回给用户；Alert组件根据配置的告警规则进行周期性的评估，如果满足规则设置的阈值则将告警推送到Alertmanager进行告警。"
				}
			]
		},
		{
			"ID": "20230419155422-wqxnbhk",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-wqxnbhk",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "应用层"
				}
			]
		},
		{
			"ID": "20230419155422-3sx0r1w",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-3sx0r1w",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "应用层包含直接面向用户的应用，如Grafana大屏展示、Alertmanager告警分发，当然也包括一些用户自研的组件。"
				}
			]
		},
		{
			"ID": "20230419155422-ykcpktd",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20230419155422-ykcpktd",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "总结"
				}
			]
		},
		{
			"ID": "20230419155422-tu66xh9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230419155422-tu66xh9",
				"updated": "20230419155422"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在大规模集群场景下，节点数量大，采集任务重，如何有效降低每个采集器的采集压力是我们需要重点考虑的问题。同时，面对海量数据的存储需求，需要考虑存储方案的水平可扩展能力。上述的分层架构设计，各层间相对独立，没有强耦合，可以进行独立的方案设计以及容量的扩缩容，从而有效保证整个系统的稳定性。"
				}
			]
		}
	]
}