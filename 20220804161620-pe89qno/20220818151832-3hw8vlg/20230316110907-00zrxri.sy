{
	"ID": "20230316110907-00zrxri",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20230316110907-00zrxri",
		"title": "节点注册",
		"updated": "20230316124724"
	},
	"Children": [
		{
			"ID": "20230316110938-afhhovd",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230316110938-afhhovd",
				"updated": "20230316110945"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "1. 概述"
				}
			]
		},
		{
			"ID": "20230316110945-6cmb2xf",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316110945-6cmb2xf",
				"updated": "20230316111203"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "k8s集群进行节点管理时，需要进行集群扩缩容，即节点添加和删除，这里主要介绍添加节点的两种方式："
				}
			]
		},
		{
			"ID": "20230316111118-seol73h",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230316111118-seol73h",
				"updated": "20230316111228"
			},
			"Children": [
				{
					"ID": "20230316111212-b9lwdni",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111212-b9lwdni"
					},
					"Children": [
						{
							"ID": "20230316111219-au4zhbq",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111219-au4zhbq"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "节点上的 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "kubelet"
								},
								{
									"Type": "NodeText",
									"Data": " 向控制面执行自注册；"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111228-4bw67bb",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111228-4bw67bb",
						"updated": "20230316111228"
					},
					"Children": [
						{
							"ID": "20230316111228-qc9bf99",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111228-qc9bf99",
								"updated": "20230316111228"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "手动添加一个 Node 对象。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230316110907-l36z004",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316110907-l36z004",
				"updated": "20230316111509"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "在创建了 Node "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects/#kubernetes-objects",
					"TextMarkTextContent": "对象"
				},
				{
					"Type": "NodeText",
					"Data": "或者节点上的 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "kubelet"
				},
				{
					"Type": "NodeText",
					"Data": " 执行了自注册操作之后，控制面会检查新的 Node 对象是否合法。"
				}
			]
		},
		{
			"ID": "20230316111535-huqh6vi",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111535-huqh6vi",
				"updated": "20230316111535"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Kubernetes 会在内部创建一个 Node 对象作为节点的表示。Kubernetes 检查 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "kubelet"
				},
				{
					"Type": "NodeText",
					"Data": " 向 API 服务器注册节点时使用的 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "metadata.name"
				},
				{
					"Type": "NodeText",
					"Data": " 字段是否匹配。 如果节点是健康的（即所有必要的服务都在运行中），则该节点可以用来运行 Pod。 否则，直到该节点变为健康之前，所有的集群活动都会忽略该节点。"
				}
			]
		},
		{
			"ID": "20230316111604-wue4xhp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111604-wue4xhp",
				"updated": "20230316111613"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "说明"
				},
				{
					"Type": "NodeText",
					"Data": "："
				}
			]
		},
		{
			"ID": "20230316111614-50r3rpb",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111614-50r3rpb",
				"updated": "20230316111634"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Kubernetes 会一直保存着非法节点对应的对象，并持续检查该节点是否已经变得健康。必须显式地删除该 Node 对象以停止健康检查操作。"
				}
			]
		},
		{
			"ID": "20230316111810-388nhgq",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111810-388nhgq",
				"updated": "20230316111811"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "Node 对象的名称必须是合法的 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/names#dns-subdomain-names",
					"TextMarkTextContent": "DNS 子域名"
				},
				{
					"Type": "NodeText",
					"Data": "。"
				}
			]
		},
		{
			"ID": "20230316111505-cpe5jex",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230316111505-cpe5jex",
				"updated": "20230316111904"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "2. 节点自注册"
				}
			]
		},
		{
			"ID": "20230316111913-2a0eozy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111913-2a0eozy",
				"updated": "20230316111920"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当 kubelet 标志"
				},
				{
					"Type": "NodeText",
					"Data": " "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "mark",
					"TextMarkTextContent": "--register-node 为 true（默认）"
				},
				{
					"Type": "NodeText",
					"Data": "时，它会尝试向 API 服务注册自己。 这是首选模式，被绝大多数发行版选用。"
				}
			]
		},
		{
			"ID": "20230316111913-nycah4t",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111913-nycah4t",
				"updated": "20230316111913"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "对于自注册模式，kubelet 使用下列参数启动："
				}
			]
		},
		{
			"ID": "20230316111913-xhrp0ks",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20230316111913-xhrp0ks",
				"updated": "20230316111913"
			},
			"Children": [
				{
					"ID": "20230316111913-z8vuwzt",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-z8vuwzt"
					},
					"Children": [
						{
							"ID": "20230316111913-vm3y6ka",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-vm3y6ka"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--kubeconfig"
								},
								{
									"Type": "NodeText",
									"Data": " - 用于向 API 服务器执行身份认证所用的凭据的路径。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-yxnlnas",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-yxnlnas"
					},
					"Children": [
						{
							"ID": "20230316111913-h4ke896",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-h4ke896"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--cloud-provider"
								},
								{
									"Type": "NodeText",
									"Data": " - 与某"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cloud-provider",
									"TextMarkTextContent": "云驱动"
								},
								{
									"Type": "NodeText",
									"Data": " 进行通信以读取与自身相关的元数据的方式。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-hnj3e90",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-hnj3e90"
					},
					"Children": [
						{
							"ID": "20230316111913-vozcc9q",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-vozcc9q"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--register-node"
								},
								{
									"Type": "NodeText",
									"Data": " - 自动向 API 服务注册。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-rgqjoxt",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-rgqjoxt"
					},
					"Children": [
						{
							"ID": "20230316111913-6lcxve6",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-6lcxve6"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--register-with-taints"
								},
								{
									"Type": "NodeText",
									"Data": " - 使用所给的"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/taint-and-toleration/",
									"TextMarkTextContent": "污点"
								},
								{
									"Type": "NodeText",
									"Data": "列表 （逗号分隔的 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "\u0026lt;key\u0026gt;=\u0026lt;value\u0026gt;:\u0026lt;effect\u0026gt;"
								},
								{
									"Type": "NodeText",
									"Data": "）注册节点。当 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "register-node"
								},
								{
									"Type": "NodeText",
									"Data": " 为 false 时无效。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-04b73r3",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-04b73r3"
					},
					"Children": [
						{
							"ID": "20230316111913-prlu1g0",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-prlu1g0"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--node-ip"
								},
								{
									"Type": "NodeText",
									"Data": " - 节点 IP 地址。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-cphhpbu",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-cphhpbu"
					},
					"Children": [
						{
							"ID": "20230316111913-9ioe2io",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-9ioe2io"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--node-labels"
								},
								{
									"Type": "NodeText",
									"Data": " - 在集群中注册节点时要添加的"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/",
									"TextMarkTextContent": "标签"
								},
								{
									"Type": "NodeText",
									"Data": "。 （参见 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "a",
									"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/admission-controllers/#noderestriction",
									"TextMarkTextContent": "NodeRestriction 准入控制插件"
								},
								{
									"Type": "NodeText",
									"Data": "所实施的标签限制）。"
								}
							]
						}
					]
				},
				{
					"ID": "20230316111913-9a92oin",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20230316111913-9a92oin"
					},
					"Children": [
						{
							"ID": "20230316111913-e0trzfl",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20230316111913-e0trzfl"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "--node-status-update-frequency"
								},
								{
									"Type": "NodeText",
									"Data": " - 指定 kubelet 向 API 服务器发送其节点状态的频率。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20230316111913-uut2y7d",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316111913-uut2y7d",
				"updated": "20230316111913"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/node/",
					"TextMarkTextContent": "Node 鉴权模式"
				},
				{
					"Type": "NodeText",
					"Data": "和 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/admission-controllers/#noderestriction",
					"TextMarkTextContent": "NodeRestriction 准入插件"
				},
				{
					"Type": "NodeText",
					"Data": "被启用后， 仅授权 kubelet 创建/修改自己的 Node 资源。"
				}
			]
		},
		{
			"ID": "20230316112538-8co7hew",
			"Type": "NodeBlockquote",
			"Properties": {
				"id": "20230316112538-8co7hew",
				"updated": "20230316124540"
			},
			"Children": [
				{
					"ID": "20230316124437-hq54zq8",
					"Type": "NodeParagraph",
					"Properties": {
						"id": "20230316124437-hq54zq8",
						"updated": "20230316124439"
					},
					"Children": [
						{
							"Type": "NodeText",
							"Data": "说明："
						}
					]
				},
				{
					"ID": "20230316112538-100xygx",
					"Type": "NodeParagraph",
					"Properties": {
						"id": "20230316112538-100xygx",
						"updated": "20230316124539"
					},
					"Children": [
						{
							"Type": "NodeText",
							"Data": "当执行kubectl delete node xxxx后，节点就会被从etcd中删除掉，集群中删除该节点，当kubelet重启后，节点会向apiserver服务发起自注册，如果未执行kubeadm reset -f或者集群中的配置未被删除（未执行kubeadm reset -f），可能导致节点自动重新加入集群。"
						}
					]
				},
				{
					"ID": "20230316124539-bbl6yur",
					"Type": "NodeParagraph",
					"Properties": {
						"id": "20230316124539-bbl6yur",
						"updated": "20230316124540"
					},
					"Children": [
						{
							"Type": "NodeText",
							"Data": "如果在 kubelet 重启期间 Node 配置发生了变化，已经被调度到某 Node 上的 Pod 可能会出现行为不正常或者出现其他问题，例如，已经运行的 Pod 可能通过污点机制设置了与 Node 上新设置的标签相排斥的规则，也有一些其他 Pod， 本来与此 Pod 之间存在不兼容的问题，也会因为新的标签设置而被调到同一节点。 节点重新注册操作可以确保节点上所有 Pod 都被排空并被正确地重新调度"
						}
					]
				},
				{
					"Type": "NodeBlockquoteMarker",
					"Data": "\u003e"
				}
			]
		},
		{
			"ID": "20230316111950-qynbmsd",
			"Type": "NodeHeading",
			"HeadingLevel": 1,
			"Properties": {
				"id": "20230316111950-qynbmsd",
				"updated": "20230316124644"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "3. 手动注册"
				}
			]
		},
		{
			"ID": "20230316124644-knayjxm",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316124644-knayjxm",
				"updated": "20230316124724"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "如果希望手动创建节点对象，可以设置kubelet flag参数"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "--register-node=false"
				},
				{
					"Type": "NodeText",
					"Data": "。"
				}
			]
		},
		{
			"ID": "20230316112447-f2ohnj6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20230316112447-f2ohnj6",
				"updated": "20230316112447"
			}
		}
	]
}